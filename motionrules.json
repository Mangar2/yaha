{
    "rules": {
        "setReceived": {
            "anyOf": [
                "$SYS/presence/set", "system/presence/set"
            ],
            "topic": {
                "$SYS/presence": ["switch", "$SYS/presence/set", { 
                    "0": "absent", "1": "awake", "absent": "absent", "sleeping": "sleeping", "awake": "awake"
                }],
                "system/presence": ["switch", "$SYS/presence/set", { 
                    "0": "absent", "1": "awake", "absent": "absent", "sleeping": "sleeping", "awake": "awake"
                }],
                "outdoor/garden/main/switch/lightstairs/blink": ["switch", "$SYS/presence/set", { 
                    "0": "1", "1": "2", "absent": "1", "sleeping": "0", "awake": "2"
                }]
            }
        },
        "initialize": {
            "check": ["=", "$SYS/presence", "initial"],
            "topic": ["$SYS/presence", "system/presence"],
            "anyOf": [
                "+/+/+/motion sensor/detection state"
            ],
            "value": "awake"
        },
        "sleeping": {
            "time": "21:00",
            "duration": "8:00",
            "check": ["=", "$SYS/presence", "awake"],
            "durationWithoutMovementInMinutes": 15,
            "allOf": [
                "first/hallway/main/motion sensor/detection state"
            ],
            "allow": [
                "first/bathroom/main/motion sensor/detection state",
                "first/study/main/motion sensor/detection state",
                "first/dressingroom/main/motion sensor/detection state"            
            ],
            "topic": ["$SYS/presence", "system/presence"],
            "value": "sleeping"
        },
        "wakeup": {
            "check": ["=", "$SYS/presence", "sleeping"],
            "durationWithoutMovementInMinutes": 0,
            "anyOf": [
                "+/+/+/motion sensor/detection state"
            ],
            "noneOf": [
                "first/hallway/main/motion sensor/detection state",
                "first/bathroom/main/motion sensor/detection state"
            ],
            "topic": ["$SYS/presence", "system/presence"],
            "value": "awake"
        },
        "homecoming": {
            "check": ["=", "$SYS/presence", "absent"],
            "durationWithoutMovementInMinutes": 0,
            "allOf": [
                "ground/hallway/wall/motion sensor/detection state",
                "ground/hallway/center/motion sensor/detection state"
            ],
            "allow": [
                "ground/wardrobe/main/motion sensor/detection state"
            ],
            "topic": ["$SYS/presence", "system/presence"],
            "value": "awake"
        },
        "alert": {
            "check": ["=", "$SYS/presence", "absent"],
            "durationWithoutMovementInMinutes": 0,
            "anyOf": [
                "+/+/+/motion sensor/detection state"
            ],
            "topic": ["$SYS/alarm/set"],
            "value": "movement"
        },
        "leaving": {
            "check": ["=", "$SYS/presence", "awake"],
            "durationWithoutMovementInMinutes": 30,
            "allOf": [
                "ground/hallway/wall/motion sensor/detection state"
            ],
            "allow": [
                "ground/wardrobe/main/motion sensor/detection state",        
                "ground/hallway/center/motion sensor/detection state",
                "first/hallway/main/motion sensor/detection state"
            ],
            "topic": ["$SYS/presence", "system/presence"],
            "value": "absent"
        },
        "leaving2": {
            "time": "12:00",
            "duration": "2:00",
            "check": ["=", "$SYS/presence", "awake"],
            "durationWithoutMovementInMinutes": 20,
            "allOf": [
                "ground/hallway/wall/motion sensor/detection state"
            ],
            "allow": [
                "ground/wardrobe/main/motion sensor/detection state",        
                "ground/hallway/center/motion sensor/detection state",
                "first/hallway/main/motion sensor/detection state"
            ],
            "topic": ["$SYS/presence", "system/presence"],
            "value": "absent"
        },
        "cleaningFirst": {
            "time": "14:00",
            "duration": "00:15",
            "durationWithoutMovementInMinutes": 0,
            "check": ["=", "$SYS/presence", "absent"],
            "allOf": [
                "first/study/main/motion sensor/detection state"
            ],
            "topic": "$SYS/cleaning/first",
            "value": "cleaning"
        },        
        "cleaningFirstFinished": {
            "durationWithoutMovementInMinutes": 15,
            "check": ["=", "$SYS/cleaning/first", "cleaning"],
            "allOf": [
                "first/study/main/motion sensor/detection state"
            ],
            "topic": "$SYS/cleaning/first",
            "value": "off"
        },
        "cleaningGround": {
            "time": "14:20",
            "duration": "00:15",
            "durationWithoutMovementInMinutes": 0,
            "check": ["=", "$SYS/presence", "absent"],
            "allOf": [
                "ground/hallway/center/motion sensor/detection state"
            ],
            "topic": "$SYS/cleaning/ground",
            "value": "cleaning"
        },        
        "cleaningGroundFinished": {
            "durationWithoutMovementInMinutes": 15,
            "check": ["=", "$SYS/cleaning/ground", "cleaning"],
            "allOf": [
                "ground/hallway/center/motion sensor/detection state"
            ],
            "topic": "$SYS/cleaning/ground",
            "value": "off"
        }
    }
}
