{
    "motion": {
        "rules": {
            "setReceived": {
                "anyOf": [
                    "$SYS/presence/set", "system/presence/set"
                ],
                "topic": {
                    "$SYS/presence": ["switch", "$SYS/presence/set", { 
                        "0": "absent", "1": "awake", "absent": "absent", "sleeping": "sleeping", "awake": "awake"
                    }],
                    "system/presence": ["switch", "$SYS/presence/set", { 
                        "0": "absent", "1": "awake", "absent": "absent", "sleeping": "sleeping", "awake": "awake"
                    }],
                    "outdoor/garden/main/switch/lightstairs/blink": ["switch", "$SYS/presence/set", { 
                        "0": "1", "1": "2", "absent": "1", "sleeping": "0", "awake": "2"
                    }],
                    "$SYS/alarm": "off"
                }
            },
            "initialize": {
                "check": ["=", "$SYS/presence", "initial"],
                "anyOf": [
                    "+/+/+/motion sensor/detection state"
                ],
                "topic": { 
                    "$SYS/presence": "awake", 
                    "system/presence": "awake",
                    "$SYS/cleaning/first": 0,
                    "$SYS/cleaning/ground":0
                }
            },
            "sleeping": {
                "time": "21:00",
                "duration": "8:00",
                "check": ["=", "$SYS/presence", "awake"],
                "durationWithoutMovementInMinutes": 15,
                "allOf": [
                    "first/hallway/main/motion sensor/detection state"
                ],
                "noneOf": [
                    "ground/hallway/wall/motion sensor/detection state",
                    "ground/hallway/center/motion sensor/detection state",
                    "cellar/hobbycellar/west/motion sensor/detection state", 
                    "cellar/hobbycellar/east/motion sensor/detection state",
                    "cellar/hobbycellar/north/motion sensor/detection state",
                    "cellar/hobbycellar/motion/motion sensor/detection state",
                    "cellar/boilerroom/main/motion sensor/detection state",
                    "cellar/storeroom/main/motion sensor/detection state",
                    "cellar/hallway/main/motion sensor/detection state",
                    "ground/livingroom/main/motion sensor/detection state"
                ],
                "topic": ["$SYS/presence", "system/presence"],
                "value": "sleeping"
            },
            "wakeup1": {
                "check": ["=", "$SYS/presence", "sleeping"],
                "anyOf": [
                    "+/+/+/motion sensor/detection state"
                ],
                "noneOf": [
                    "first/hallway/main/motion sensor/detection state",
                    "first/bathroom/main/motion sensor/detection state"
                ],
                "topic": ["$SYS/presence", "system/presence"],
                "value": "awake"
            },
            "wakeup2": {
                "check": ["and", ["=", "$SYS/presence", "absent"], ["!=", "$SYS/cleaning/first", "cleaning"]],
                "allOf": [
                    "first/hallway/main/motion sensor/detection state"
                ],
                "noneOf": [
                    "ground/hallway/wall/motion sensor/detection state",
                    "ground/hallway/center/motion sensor/detection state",
                    "cellar/hobbycellar/west/motion sensor/detection state", 
                    "cellar/hobbycellar/east/motion sensor/detection state",
                    "cellar/hobbycellar/north/motion sensor/detection state",
                    "cellar/hobbycellar/motion/motion sensor/detection state",
                    "cellar/boilerroom/main/motion sensor/detection state",
                    "cellar/storeroom/main/motion sensor/detection state",
                    "cellar/hallway/main/motion sensor/detection state",
                    "ground/livingroom/main/motion sensor/detection state"
                ],
                "topic": ["$SYS/presence", "system/presence"],
                "value": "awake"
            },
            "homecoming": {
                "check": ["=", "$SYS/presence", "absent"],
                "allOf": [
                    "ground/hallway/wall/motion sensor/detection state",
                    "ground/hallway/center/motion sensor/detection state"
                ],
                "allow": [
                    "ground/wardrobe/main/motion sensor/detection state"
                ],
                "topic": ["$SYS/presence", "system/presence"],
                "value": "awake"
            },
            "leaving": {
                "check": ["=", "$SYS/presence", "awake"],
                "durationWithoutMovementInMinutes": 30,
                "allOf": [
                    "ground/hallway/wall/motion sensor/detection state"
                ],
                "allow": [
                    "ground/wardrobe/main/motion sensor/detection state",        
                    "ground/hallway/center/motion sensor/detection state",
                    "first/hallway/main/motion sensor/detection state"
                ],
                "topic": ["$SYS/presence", "system/presence"],
                "value": "absent"
            },
            "leaving2": {
                "time": "12:00",
                "duration": "2:00",
                "check": ["=", "$SYS/presence", "awake"],
                "durationWithoutMovementInMinutes": 20,
                "allOf": [
                    "ground/hallway/wall/motion sensor/detection state"
                ],
                "allow": [
                    "ground/wardrobe/main/motion sensor/detection state",        
                    "ground/hallway/center/motion sensor/detection state",
                    "first/hallway/main/motion sensor/detection state"
                ],
                "topic": ["$SYS/presence", "system/presence"],
                "value": "absent"
            },
            "cleaningFirst": {
                "time": "14:00",
                "duration": "00:15",
                "check": ["and", ["=", "$SYS/presence", "absent"], ["!=", "$SYS/cleaning/first", "cleaning"]],
                "allOf": [
                    "first/study/main/motion sensor/detection state"
                ],
                "topic": { "$SYS/cleaning/first": "cleaning" }
            },        
            "cleaningFirstFinished": {
                "durationWithoutMovementInMinutes": 15,
                "check": ["=", "$SYS/cleaning/first", "cleaning"],
                "allOf": [
                    "first/study/main/motion sensor/detection state"
                ],
                "topic": "$SYS/cleaning/first",
                "value": "off"
            },
            "cleaningGround": {
                "time": "14:20",
                "duration": "00:15",
                "check": ["and", ["=", "$SYS/presence", "absent"], ["!=", "$SYS/cleaning/ground", "cleaning"]],
                "allOf": [
                    "ground/hallway/center/motion sensor/detection state"
                ],
                "topic": { "$SYS/cleaning/ground": "cleaning" }
            },        
            "cleaningGroundFinished": {
                "durationWithoutMovementInMinutes": 15,
                "check": ["=", "$SYS/cleaning/ground", "cleaning"],
                "allOf": [
                    "ground/hallway/center/motion sensor/detection state"
                ],
                "topic": { "$SYS/cleaning/ground": "off" }
            }
        }
    }
}
