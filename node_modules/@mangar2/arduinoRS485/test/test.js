/**
 * @license
 * This software is licensed under the GNU LESSER GENERAL PUBLIC LICENSE Version 3. It is furnished
 * "as is", without any support, and with no warranty, express or implied, as to its usefulness for
 * any purpose.
 *
 * @author Volker Böhm
 * @copyright Copyright (c) 2020 Volker Böhm
 */

'use strict'
const { delay } = require('@mangar2/utils')

/*

console.log('testing serialmessage ...')
require('./testserialmessage')

console.log('testing rs485state ...')
require('./teststate')

console.log('testing rs485schedule')
require('./testrs485')

console.log('testing testread')
require('./testread')

console.log('testing arduinodns')
require('./testarduinodns')
*/
const ArduinoRS485 = require('../arduinors485')
const arduinoService = new ArduinoRS485(
    {
        serialPortName: 'COM11',
        addresses: {
            'myfloor/myroom/mydevice/': 20
        }
    }
)

arduinoService.on('publish', (message) => {
    console.log('%s = %s', message.topic, message.value)
})

const main = async () => {
    await arduinoService.run()
    await delay(20000, true)
    // arduinoService.close()
}

main()
