[{
    "description": "leaving rule",
    "rule": {
        "motion": {
            "rules": {
                "alarm": {
                    "check": ["=", "system/state/presence", "absent"],
                    "anyOf": [
                        "first/required/motion",
                        "first/one/motion",
                        "first/two/motion",
                        "first/three/motion"
                    ],
                    "topic": { "$SYS/alarm": "motion when absent" }
                },
                "leaving": {
                    "check": ["=", "system/state/presence", "awake"],
                    "durationWithoutMovementInMinutes": 15,
                    "anyOf": [
                        "first/required/motion"
                    ],
                    "allow": [
                        "first/one/motion",
                        "first/two/motion",
                        "first/three/motion"
                    ],
                    "topic": { "system/state/presence": "absent" }
                },
                "homecoming": {
                    "check": ["=", "system/state/presence", "absent"],
                    "anyOf": [
                        "first/required/motion"
                    ],
                    "allow": [
                        "first/one/motion",
                        "first/two/motion",
                        "first/three/motion"
                    ],
                    "topic": "system/state/presence",
                    "value": "awake"
                }
            }
        }
    },
    "subscriptions": 
    { 
        "$SYS/+/set": 2, "+/+/motion": 2, "system/state/presence": 2, "$SYS/simulation/#":1
    },
    "tests": [
        {
            "description": "leaving, not enough time passed",
            "variables": { "system/state/presence": "awake" },
            "time": "7:14",
            "motions": {"first/required/motion": "7:00"},
            "results": []
        },
        {
            "description": "already absent, move long time ago ",
            "variables": { "system/state/presence": "absent" },
            "time": "7:16",
            "motions": {"first/required/motion": "7:00"},
            "results": []
        },
        {
            "description": "already absent, actual move",
            "variables": { "system/state/presence": "absent" },
            "time": "7:16",
            "motions": {"first/required/motion": "7:00", "first/one/motion": "7:15:30" },
            "results": [
                {
                    "topic": "$SYS/alarm",
                    "value": "motion when absent",
                    "qos": 1
                }
            ]
        },
        {
            "description": "leaving, allowed move too late",
            "variables": { "system/state/presence": "awake" },
            "time": "7:16",
            "motions": {"first/required/motion": "7:00", "first/one/motion": "7:15:30" },
            "results": []
        },
        {
            "description": "successfull leaving",
            "variables": { "system/state/presence": "awake" },
            "time": "7:16",
            "motions": {"first/required/motion": "7:00"},
            "results": [
                {
                    "topic": "system/state/presence",
                    "value": "absent",
                    "qos": 1
                }
            ]
        },
        {
            "description": "left, old information will be ignored 1",
            "variables": { "system/state/presence": "absent" },
            "time": "7:16",
            "motions": {"first/required/motion": "7:00"},
            "results": []
        },
        {
            "description": "left, old information will be ignored 2",
            "variables": { "system/state/presence": "absent" },
            "time": "7:16:30",
            "motions": {"first/required/motion": "7:00"},
            "results": []
        },
        {
            "description": "coming home again",
            "variables": { "system/state/presence": "absent" },
            "time": "7:20:00",
            "motions": {"first/one/motion": "7:00", "first/required/motion": "7:20:00"},
            "results": [
                {
                    "topic": "$SYS/alarm",
                    "value": "motion when absent",
                    "qos": 1
                },
                {
                    "topic": "system/state/presence",
                    "value": "awake",
                    "qos": 1
                }
            ]
        }
    ]
}]