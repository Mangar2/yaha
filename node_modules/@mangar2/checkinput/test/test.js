/**
 * @license
 * This software is licensed under the GNU LESSER GENERAL PUBLIC LICENSE Version 3. It is furnished
 * "as is", without any support, and with no warranty, express or implied, as to its usefulness for
 * any purpose.
 *
 * @author Volker Böhm
 * @copyright Copyright (c) 2020 Volker Böhm
 */

'use scrict'

const CheckInput = require('@mangar2/checkInput')
const UnitTest = require('@mangar2/unittest')

const unitTest = new UnitTest(false)

function checkSchema (definition) {
    for (const schema of definition) {
        const check = new CheckInput(schema.schema)
        for (const test of schema.tests) {
            const result = check.validate(test.data)
            if (result !== test.valid) {
                // for debuggin, set breakpoint here
                check.validate(test.data)
            }
            unitTest.assertEqual(result, test.valid, schema.description + ' - ' + test.description)
            if (result.messages !== undefined) {
                unitTest.log(result.messages)
            }
        }
    }
}

const files = [
    'additionalItems',
    'additionalProperties',
    'allOf',
    'anyOf',
    'boolean_schema',
    'const',
    'contains',
    'enum',
    'exclusiveMaximum',
    'exclusiveMinimum',
    'items',
    'if-then-else',
    'maximum',
    'maxItems',
    'maxLength',
    'maxProperties',
    'minimum',
    'minItems',
    'minLength',
    'minProperties',
    'multipleOf',
    'not',
    'oneOf',
    'properties',
    'ref',
    'required',
    'type',
    'uniqueItems'
]
for (const file of files) {
    const testData = require('./' + file + '.json')
    checkSchema(testData)
}

unitTest.showResult(323)
