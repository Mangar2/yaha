<!-- Generated by documentation.js. Update this documentation by updating the source code. -->

### Table of Contents

-   [Connections][1]
    -   [Parameters][2]
    -   [restoreFromFile][3]
    -   [persist][4]
    -   [connect][5]
        -   [Parameters][6]
    -   [disconnect][7]
        -   [Parameters][8]
    -   [cleanup][9]
    -   [subscribe][10]
        -   [Parameters][11]
    -   [unsubscribe][12]
        -   [Parameters][13]
    -   [onPubrel][14]
        -   [Parameters][15]
    -   [setWill][16]
        -   [Parameters][17]
    -   [publishMessage][18]
        -   [Parameters][19]
    -   [acknowledgeMessage][20]
        -   [Parameters][21]
    -   [getAllMessagesToSend][22]
-   [client][23]
    -   [host][24]
    -   [port][25]
    -   [clientId][26]
    -   [orderedTopicsQueue][27]
    -   [orderedTopicsQueue][28]
        -   [Parameters][29]
    -   [qos0Queue][30]
    -   [qos0Queue][31]
        -   [Parameters][32]
    -   [will][33]
    -   [will][34]
        -   [Parameters][35]
    -   [sendToken][36]
    -   [actualizeLastActiveTimestamp][37]
    -   [isAlive][38]
    -   [isConnected][39]
    -   [restoreFromJSON][40]
        -   [Parameters][41]
    -   [setClean][42]
        -   [Parameters][43]
    -   [cleanupQos2Queue][44]
        -   [Parameters][45]
    -   [connect][46]
        -   [Parameters][47]
    -   [subscribe][48]
        -   [Parameters][49]
    -   [unsubscribe][50]
        -   [Parameters][51]
    -   [deleteFromQos2Queue][52]
        -   [Parameters][53]
    -   [isInQos2Queue][54]
        -   [Parameters][55]
    -   [addToQos2Queue][56]
        -   [Parameters][57]
    -   [publishMessage][58]
        -   [Parameters][59]
    -   [acknowledgeMessageById][60]
        -   [Parameters][61]
    -   [getAllMessagesToSend][62]
        -   [Parameters][63]
    -   [maxQueueSize][64]
        -   [Parameters][65]
-   [MessageQueues][66]
    -   [queues][67]
        -   [Parameters][68]
    -   [rebuild][69]
        -   [Parameters][70]
    -   [addMessage][71]
        -   [Parameters][72]
    -   [acknowledgeMessageById][73]
        -   [Parameters][74]
    -   [getMessagesToSend][75]
        -   [Parameters][76]
    -   [getMaxRetryCount][77]
    -   [clearRetryCount][78]
-   [MessageQueue][79]
    -   [queue][80]
    -   [queue][81]
        -   [Parameters][82]
    -   [rebuild][83]
        -   [Parameters][84]
    -   [addMessage][85]
        -   [Parameters][86]
    -   [deleteAllEntries][87]
-   [MessageQueueEntry][88]
    -   [Parameters][89]
    -   [payload][90]
    -   [packetid][91]
    -   [qos][92]
    -   [dup][93]
    -   [retain][94]
    -   [clientId][95]
    -   [status][96]
    -   [version][97]
    -   [transmitTimestamp][98]
    -   [retryCount][99]
    -   [token][100]
    -   [host][101]
    -   [port][102]
    -   [restoreFromObject][103]
        -   [Parameters][104]
    -   [setClientInfo][105]
        -   [Parameters][106]
    -   [setStatusToPubrel][107]
    -   [setTransmissionTimestamp][108]
    -   [isStatusPubrel][109]
    -   [link][110]

## 

**Meta**

-   **copyright**: Copyright (c) 2020 Volker Böhm

-   **author**: Volker Böhm
-   **license**: This software is licensed under the GNU LESSER GENERAL PUBLIC LICENSE Version 3. It is furnished
    "as is", without any support, and with no warranty, express or implied, as to its usefulness for
    any purpose.

## Connections

Creates a connection object
This class is part of an MQTT style broker. It manages connections to the broker.

### Parameters

-   `configuration` **[Object][111]** configuration
    -   `configuration.fileName` **[string][112]** filename for persistence
    -   `configuration.directory` **[string][112]** directory (file path) for persistence
    -   `configuration.replyTimeoutInMilliseconds` **nubmber** timeout to wait for an answer
        of a http call, default 10 seconds
    -   `configuration.inFlightWindow` **[number][113]** amount of qos 1 and qos 2 messages
        send for the same topic at the same time, default 1
    -   `configuration.pubrelTimeoutInMilliseconds` **[number][113]** timout to wait for a
        corresponding pubrel message, default one day
    -   `configuration.maxRetryCount` **[number][113]** amount of resend of messages
        before forcing a disconnect
    -   `configuration.maxQueuSize` **[number][113]** maximal amount of entries in a message queue

### restoreFromFile

Restores all clients from last valid saved file

### persist

Persists all connections

### connect

Connects a client (Stores a connection to a client)

#### Parameters

-   `clientId` **any** id of the client
-   `host` **[string][112]** host name
-   `port` **[string][112]** port name
-   `clean` **bool** true, if the connection will be cleaned on disconnect (optional, default `true`)
-   `version` **[string][112]** client interface version (optional, default `'1.0'`)
-   `keepAlive` **[number][113]** keep alive time in milliseconds. The broker will disconnect
    any client not sending messages in the keepAlive interval. Default is one hour (optional, default `3600000`)


-   Throws **[Error][114]** 

Returns **[Object][111]** {mqttcode, present} present == 1, if an old session is recovered

### disconnect

Disconnects a client

#### Parameters

-   `clientId` **[string][112]** id of the client


-   Throws **[Error][114]** 

### cleanup

Clean up jobs. Call regularly (example once a minute)
Automatically disconnects clients not sending data until timeout

### subscribe

Subscribes to topics

#### Parameters

-   `clientId` **[string][112]** id of the client
-   `topics` **[Object][111]** {QoS, topics} or {topic1: QoS1, topic2: QoS2, ...}

Returns **[Array][115]&lt;[number][113]>** array of QoS values

### unsubscribe

Unsubsribes to topics

#### Parameters

-   `clientId` **[string][112]** id of the client
-   `topics` **[Array][115]&lt;[string][112]>** array of topics strings (topic with wildchars '+' and '#')

### onPubrel

Handles a pubrel message, deleting the entry from the qos2 queue

#### Parameters

-   `token` **[string][112]** client send token
-   `packetid` **[number][113]** unique identifier of the corresponding publish packet

### setWill

Sets the will message of a client

#### Parameters

-   `clientId` **[string][112]** id of the client
-   `will` **[Object][111]** will message configuration
    -   `will.qos` **[number][113]** will message quality of service
    -   `will.retain` **[boolean][116]** true, if the will message is retained
    -   `will.topic` **[string][112]** topic of the will message
    -   `will.value` **([string][112] \| [number][113])** value of the will message

### publishMessage

Adds messages that needs to be published

#### Parameters

-   `payload` **Message** message to add to a publish storage
-   `qos` **[Object][111]** quality of service received from published headers
-   `retain` **[boolean][116]** true, if the message should be retained for future subscribers

### acknowledgeMessage

Acknowledges a message (qos = 1 or 2 only)

#### Parameters

-   `queueEntry` **[MessageQueueEntry][117]** entry of message queue acknowledged

### getAllMessagesToSend

Gets all messages to send for all clients
function to be called for each message. The function has the parameter QoS and message

Returns **integer** amount of messages sent

## 

**Meta**

-   **copyright**: Copyright (c) 2020 Volker Böhm

-   **author**: Volker Böhm
-   **license**: This software is licensed under the GNU LESSER GENERAL PUBLIC LICENSE Version 3. It is furnished
    "as is", without any support, and with no warranty, express or implied, as to its usefulness for
    any purpose.

## client

Creates a new connection
The Client class corresponds to a connection, it is created for each client subscribing to the broker
It stores all client status and provides functions to identify the messages to send to the client

### host

Gets/Sets the name of the sender host

Type: [string][112]

### port

Gets/Sets the number of the client port

Type: [number][113]

### clientId

get/set the id of the client. Note: it may not be changed

Type: [string][112]

### orderedTopicsQueue

Sets/gets the queues ordered by topic

Returns **[Object][111]** map topic/topic queue

### orderedTopicsQueue

Sets the ordered topics queues

#### Parameters

-   `queues` **[Object][111]** {topic: queue, topic: queue, ...} one queue per topic

### qos0Queue

Gets the queue for qos=0 messages

Returns **[Array][115]&lt;[MessageQueueEntry][117]>** queue for qos0 messages

### qos0Queue

Sets the queue for qos=0 messages

#### Parameters

-   `queue` **[Array][115]&lt;[MessageQueueEntry][117]>** for qos0 messages

### will

Sets the will message

Returns **[Object][111]** will message configuration

### will

Sets the will message configuration

#### Parameters

-   `will` **[Object][111]** will message configuration
    -   `will.qos` **[number][113]** will message quality of service
    -   `will.retain` **[boolean][116]** true, if the will message is retained
    -   `will.topic` **[string][112]** topic of the will message
    -   `will.value` **([string][112] \| [number][113])** value of the will message

### sendToken

Gets the token the client will use to publish data

Returns **[string][112]** 

### actualizeLastActiveTimestamp

Sets the last active timestamp to now

### isAlive

Checks, if the client has received messages lately

Returns **[boolean][116]** true, if the client is alive

### isConnected

Checks, if the client is currently connected

Returns **[boolean][116]** true, if the client is connected

### restoreFromJSON

Restores the client from a JSON object.

#### Parameters

-   `jsonObject` **[Object][111]** 

### setClean

Sets the clean value (does NOT clean the session). If the parameter clean is
undefined AND the property clean is undefined it will set clean to true.

#### Parameters

-   `clean` **([boolean][116] \| [string][112])** new clean value (accepts true, "true", 1, "1" as true value). Any other value is false.

### cleanupQos2Queue

Removes old entries from the qos2Queue

#### Parameters

-   `timeoutInMilliseconds` **[number][113]** amount of milliseconds to keep entries in
    the queue

### connect

sets the connection to "connected", resets the unsuccessful counter to 0, starts with
messageId 0 and stores the current timestamp.

#### Parameters

-   `clientId` **any** id of the client
-   `host` **[string][112]** host name
-   `port` **[string][112]** port name
-   `clean` **bool** true, if the connection will be cleaned on disconnect (optional, default `true`)
-   `version` **[string][112]** client interface version (optional, default `'1.0'`)
-   `keepAlive` **[number][113]** keep alive time in milliseconds. The broker will disconnect
    any client not sending messages in the keepAlive interval. Default is one hour (optional, default `3600*1000`)

Returns **[Object][111]** connection tokens {send, receive}

### subscribe

Adds a subscription to the connection

#### Parameters

-   `clientId` **any** id of the client
-   `topics` **[Object][111]** {topic1:QoS1, topic2:Qos2, ...}


-   Throws **[Error][114]** if clientId does not match or subscription is not given

### unsubscribe

removes subscriptions from topics

#### Parameters

-   `clientId` **any** id of the client
-   `topics` **([string][112] \| [Array][115])** array of topic strings with wildchars


-   Throws **[Error][114]** if clientId does not match or subscription is not given

### deleteFromQos2Queue

Deletes an entry from the qos2 queue

#### Parameters

-   `packetid` **[number][113]** unique identifier of the packet (unique by client)

### isInQos2Queue

Checks, if a packet id is in the qos 2 queue.

#### Parameters

-   `packetid` **[number][113]** unique identifier of the packet (unique by client)

### addToQos2Queue

Adds an entry to the qos=2 queue to remember send packages and to ignore duplicates

#### Parameters

-   `packetid` **[number][113]** id of the package
-   `topic` **[string][112]** topic of the corresponding message

### publishMessage

"Publishes" messages by adding them to the publish queues. The messages must then still be sent
to the client afterwards

#### Parameters

-   `param` **[Object][111]** parameters
    -   `param.payload` **Message** message to add to a publish storage
    -   `param.qos` **[number][113]** quality of service received from published headers
    -   `param.retain` **[boolean][116]** true, if the message is triggered from a retained message
-   `pattern` **TopicMatch** optional: alternative match filter to filter messages (optional, default `undefined`)

### acknowledgeMessageById

Acknowledges a message, either delete it or set it to pubrel

#### Parameters

-   `topic` **[string][112]** topic to delete message from
-   `packetid` **[number][113]** id of the message

### getAllMessagesToSend

Get all messages to send

#### Parameters

-   `inFlightWindow` **[number][113]** maximal amount of qos1 and qos2 messages to process
-   `timeoutInMilliseconds` **[number][113]** timeout waiting for messages

Returns **[Array][115]&lt;Message>** messages that should be sent to the client

### maxQueueSize

Sets/gets the maximal length of a queue per topic. Longer queues will be truncated

#### Parameters

-   `size` **integer** maximal size of the queue

Returns **integer** maximal size of the queue

## 

**Meta**

-   **copyright**: Copyright (c) 2020 Volker Böhm

-   **author**: Volker Böhm
-   **license**: This software is licensed under the GNU LESSER GENERAL PUBLIC LICENSE Version 3. It is furnished
    "as is", without any support, and with no warranty, express or implied, as to its usefulness for
    any purpose.

## MessageQueues

Creates an object holding many message queues, one per topic. Each queue is accessible by providing the topic

### queues

Sets the message queues

#### Parameters

-   `queues` **[Object][111]** map mapping topics to messagequeues

### rebuild

Recreates the message queue from persistend data

#### Parameters

-   `data` **[Object][111]** format {topic: queue, topic: queue, ...}

### addMessage

Adds a message, cuts the queue to maxQueueSize, if too long

#### Parameters

-   `entry` **[MessageQueueEntry][117]** entry of the message queue
-   `maxQueueSize` **[number][113]** maximal number of entries in queue

### acknowledgeMessageById

Acknowledges a message, either delete it or set it to pubrel

#### Parameters

-   `topic` **[string][112]** topic to delete message from
-   `packetid` **[number][113]** id of the message

### getMessagesToSend

get messages to send for a topic

#### Parameters

-   `inFlightWindow` **[number][113]** maximal amount of messages to process
-   `timeoutInMilliseconds` **[number][113]** timeout waiting for messages

### getMaxRetryCount

Gets the maximal retry count for a client

Returns **any** the maximal retry count of the first elements of all topics

### clearRetryCount

clears all retry counts

## 

**Meta**

-   **copyright**: Copyright (c) 2020 Volker Böhm

-   **author**: Volker Böhm
-   **license**: This software is licensed under the GNU LESSER GENERAL PUBLIC LICENSE Version 3. It is furnished
    "as is", without any support, and with no warranty, express or implied, as to its usefulness for
    any purpose.

## MessageQueue

Creates a message queue that is initially empty

### queue

Gets the queue

Returns **[Array][115]&lt;[MessageQueueEntry][117]>** queue of message queue entries

### queue

Sets the queue

#### Parameters

-   `queue`  {MessageQueueEntry\[]}

### rebuild

Recreates the message queue from persistend data

#### Parameters

-   `data` **[Object][111]** format {topic: queue, topic: queue, ...}

### addMessage

Adds a message, cuts the queue to maxQueueSize, if too long

#### Parameters

-   `entry` **[MessageQueueEntry][117]** entry of the message queue
-   `maxQueueSize` **[number][113]** maximal number of entries in queue

### deleteAllEntries

deletes all entries and returns all deleted entries

Returns **\[[MessageQueueEntry][117]]** 

## 

**Meta**

-   **copyright**: Copyright (c) 2020 Volker Böhm

-   **author**: Volker Böhm
-   **license**: This software is licensed under the GNU LESSER GENERAL PUBLIC LICENSE Version 3. It is furnished
    "as is", without any support, and with no warranty, express or implied, as to its usefulness for
    any purpose.

## MessageQueueEntry

Creates a new message queue entry storing all information to send a message including receiver

### Parameters

-   `param` **[Object][111]** parameter object (optional, default `{}`)
    -   `param.qos` **[number][113]** quality of service (0, 1 or 2) (optional, default `0`)
    -   `param.retain` **[boolean][116]** true, if the message is triggered by a retain message (optional, default `false`)
    -   `param.payload` **Message** payload of the entry (optional, default `{}`)
    -   `param.packetid` **[number][113]** id of the transmit packet
    -   `param.clientId` **[string][112]** id of the client
    -   `param.host` **[string][112]** host name or ip address of the client
    -   `param.port` **[number][113]** port number of the client
    -   `param.version` **[string][112]** version number of the client interface (x.y) (optional, default `'1.0'`)
    -   `param.token` **[string][112]** client receive token

### payload

Type: (Message | [Object][111])

### packetid

Type: [number][113]

### qos

Type: [number][113]

### dup

Type: [number][113]

### retain

Type: (`0` \| `1`)

### clientId

Type: [string][112]

### status

Type: [string][112]

### version

Type: [string][112]

### transmitTimestamp

Returns **[number][113]** timestamp of the last message transmit

### retryCount

Type: [number][113]

### token

Type: [string][112]

### host

Type: [string][112]

### port

Type: [number][113]

### restoreFromObject

Restore the object by setting all properties (usually from a file)

#### Parameters

-   `properties` **[Object][111]** object with all needed properties of this class.

### setClientInfo

Sets infos of the client

#### Parameters

-   `clientId` **[string][112]** id of the client
-   `host` **[string][112]** host name of the client
-   `port` **[number][113]** port number of the client
-   `version` **[string][112]** client interface version
-   `token` **[string][112]** token clients may check receiving published messages

### setStatusToPubrel

Sets the status to pubrel

### setTransmissionTimestamp

increases the retry counter and stores the actual timestamp

### isStatusPubrel

Checks, if the status is pubrel

Returns **[boolean][116]** 

### link

Gets the link to send the message to (/publish or /pubrel)

Returns **[string][112]** link

[1]: #connections

[2]: #parameters

[3]: #restorefromfile

[4]: #persist

[5]: #connect

[6]: #parameters-1

[7]: #disconnect

[8]: #parameters-2

[9]: #cleanup

[10]: #subscribe

[11]: #parameters-3

[12]: #unsubscribe

[13]: #parameters-4

[14]: #onpubrel

[15]: #parameters-5

[16]: #setwill

[17]: #parameters-6

[18]: #publishmessage

[19]: #parameters-7

[20]: #acknowledgemessage

[21]: #parameters-8

[22]: #getallmessagestosend

[23]: #client

[24]: #host

[25]: #port

[26]: #clientid

[27]: #orderedtopicsqueue

[28]: #orderedtopicsqueue-1

[29]: #parameters-9

[30]: #qos0queue

[31]: #qos0queue-1

[32]: #parameters-10

[33]: #will

[34]: #will-1

[35]: #parameters-11

[36]: #sendtoken

[37]: #actualizelastactivetimestamp

[38]: #isalive

[39]: #isconnected

[40]: #restorefromjson

[41]: #parameters-12

[42]: #setclean

[43]: #parameters-13

[44]: #cleanupqos2queue

[45]: #parameters-14

[46]: #connect-1

[47]: #parameters-15

[48]: #subscribe-1

[49]: #parameters-16

[50]: #unsubscribe-1

[51]: #parameters-17

[52]: #deletefromqos2queue

[53]: #parameters-18

[54]: #isinqos2queue

[55]: #parameters-19

[56]: #addtoqos2queue

[57]: #parameters-20

[58]: #publishmessage-1

[59]: #parameters-21

[60]: #acknowledgemessagebyid

[61]: #parameters-22

[62]: #getallmessagestosend-1

[63]: #parameters-23

[64]: #maxqueuesize

[65]: #parameters-24

[66]: #messagequeues

[67]: #queues

[68]: #parameters-25

[69]: #rebuild

[70]: #parameters-26

[71]: #addmessage

[72]: #parameters-27

[73]: #acknowledgemessagebyid-1

[74]: #parameters-28

[75]: #getmessagestosend

[76]: #parameters-29

[77]: #getmaxretrycount

[78]: #clearretrycount

[79]: #messagequeue

[80]: #queue

[81]: #queue-1

[82]: #parameters-30

[83]: #rebuild-1

[84]: #parameters-31

[85]: #addmessage-1

[86]: #parameters-32

[87]: #deleteallentries

[88]: #messagequeueentry

[89]: #parameters-33

[90]: #payload

[91]: #packetid

[92]: #qos

[93]: #dup

[94]: #retain

[95]: #clientid-1

[96]: #status

[97]: #version

[98]: #transmittimestamp

[99]: #retrycount

[100]: #token

[101]: #host-1

[102]: #port-1

[103]: #restorefromobject

[104]: #parameters-34

[105]: #setclientinfo

[106]: #parameters-35

[107]: #setstatustopubrel

[108]: #settransmissiontimestamp

[109]: #isstatuspubrel

[110]: #link

[111]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object

[112]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String

[113]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number

[114]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Error

[115]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array

[116]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean

[117]: #messagequeueentry
