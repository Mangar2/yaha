<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: generate.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: generate.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @license
 * This software is licensed under the GNU LESSER GENERAL PUBLIC LICENSE Version 3. It is furnished
 * "as is", without any support, and with no warranty, express or implied, as to its usefulness for
 * any purpose.
 *
 * @author Volker Böhm
 * @copyright Copyright (c) 2020 Volker Böhm
 */

'use strict'

const types = require('@mangar2/types')

/**
 * Creates a generator to generate descriptions from a parsed file content in json format
 * @param {Object} template generator template
 */
class Generate {
    constructor (template) {
        this._content = undefined
        this._template = template
    }

    /**
     * @private
     * @description
     * Replaces all occurences of search by replacement in str
     * @param {string} str string to replace substrings
     * @param {string} search string to replace
     * @param {string} replacement replacement
     */
    _replaceAll (str, search, replacement) {
        while (str.includes(search)) {
            str = str.replace(search, replacement)
        }
        return str
    }

    /**
     * @private
     * @description
     * Replaces tags beginning with @ in text by info-values
     * @param {string} text text with elements to replace
     * @param {Object} info replacement infos (key, value)
     */
    _replaceTags (text, info) {
        let result = ''
        if (text !== undefined) {
            result = String(text)
            for (const property in info) {
                const replacement = info[property]
                if (types.isString(replacement)) {
                    const search = '@' + property
                    result = this._replaceAll(result, search, replacement)
                }
            }
        }
        return result
    }

    /**
     * @private
     * @description
     * Generates base on a template reference
     * @param {Object[]} jsonData content extracted from a file
     * @param {Object} line single line of a generator template
     * @param {boolean} includePrivate true, if private elements shall be generated
     */
    _generateRef (jsonData, line, includePrivate) {
        let result = ''
        const definitions = this._template.$def
        if (definitions !== undefined &amp;&amp; line.$ref !== undefined &amp;&amp; definitions[line.$ref] !== undefined) {
            result = this._generateByTemplate(jsonData, definitions[line.$ref], true, includePrivate)
        }
        return result
    }

    /**
     * @private
     * @description
     * Generates a text from a template line having a single data element
     * @param {Object} jsonData content extracted from a file formatted in JSON
     * @param {Object} line single line of a generator template
     */
    _generateText (jsonData, line) {
        let result = ''
        if (line.text !== undefined) {
            result = this._replaceTags(line.text, jsonData)
        }
        return result
    }

    /**
     * @private
     * @description
     * Generates a text from a template line having a single data element
     * @param {Object} jsonData content extracted from a file formatted in JSON
     * @param {Object} line single line of a generator template
     * @param {boolean} includePrivate true, if private elements shall be generated
     */
    _generateDetail (jsonData, line, includePrivate) {
        let result = ''
        if (line['for each'] !== undefined &amp;&amp; line['iterate on'] !== undefined) {
            let detailData = jsonData[line['iterate on']]
            if (detailData === undefined) {
                detailData = []
            } else if (!types.isArray(detailData)) {
                detailData = [detailData]
            }
            let isFirst = true
            for (const jsonDataElement of detailData) {
                result += this._generateByTemplate(jsonDataElement, line['for each'], isFirst, includePrivate)
                isFirst = false
            }
        }
        return result
    }

    /**
     * @private
     * @description
     * Generates output by appliying content to a template
     * @param {Object} jsonData content extracted from a file formatted in JSON
     * @param {Object[]} template generator template
     * @param {boolean} [isFirst=true] true, if it is the first element and shall not add a separator
     * @param {boolean} [includePrivate=false] true, if private elements shall be included
     */
    _generateByTemplate (jsonData, template, isFirst = true, includePrivate = false) {
        let result = ''
        if (!types.isArray(template)) {
            template = [template]
        }
        if (jsonData !== undefined &amp;&amp; (jsonData.private === undefined || includePrivate)) {
            for (const line of template) {
                if (line['if exists'] &amp;&amp; jsonData[line['if exists']] === undefined) {
                    continue
                }
                if (line['if isfirst'] === true &amp;&amp; !isFirst) {
                    continue
                }
                if (line['if isfirst'] === false &amp;&amp; isFirst) {
                    continue
                }
                if (!isFirst &amp;&amp; line.separator !== undefined) {
                    result += line.separator
                }
                result += this._generateText(jsonData, line)
                result += this._generateDetail(jsonData, line)
                result += this._generateRef(jsonData, line)
            }
        }
        return result
    }

    /**
     * @description
     * Generates output by appliying json formatted file description to a list of templates
     * @param {Object} jsonData content of the file as JSON
     * @param {Object} options generation options
     * @param {boolean} [options.includePrivate=false] set to true to generate private elements
     */
    generate (jsonData, options = { }) {
        let result = ''
        for (const subTemplate of this._template.templates) {
            result += this._generateByTemplate(jsonData, subTemplate, options.includePrivate)
        }
        return result
    }
}

module.exports = Generate
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Generate.html">Generate</a></li><li><a href="Parse.html">Parse</a></li><li><a href="Tokenizer.html">Tokenizer</a></li></ul><h3>Global</h3><ul><li><a href="global.html#_parseAttribute">_parseAttribute</a></li><li><a href="global.html#parseParamLine">parseParamLine</a></li><li><a href="global.html#parseReturns">parseReturns</a></li><li><a href="global.html#parseThrows">parseThrows</a></li><li><a href="global.html#reportError">reportError</a></li><li><a href="global.html#requireToken">requireToken</a></li><li><a href="global.html#test">test</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.3</a> on Sun Mar 29 2020 07:50:36 GMT+0200 (GMT+02:00)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
