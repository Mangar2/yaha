/**
 * ---------------------------------------------------------------------------------------------------
 * This software is licensed under the GNU LESSER GENERAL PUBLIC LICENSE Version 3. It is furnished
 * "as is", without any support, and with no warranty, express or implied, as to its usefulness for
 * any purpose.
 *
 * File:      MatchTest.js
 *
 * Author:      Volker Böhm
 * Copyright:   Volker Böhm
 * ---------------------------------------------------------------------------------------------------
 */

'use strict'

const Message = require('@mangar2/message')
const MatchMesssage = require('../matchmessages.js')
const matchMessages = new MatchMesssage()

function matchTest (unitTest) {
    // Test that a message is matched with correct value
    matchMessages.addReceivedMessage(new Message('a/b/set', 1, 'test1'))
    let testMessage = matchMessages.matchAndUpdateReplyMessage(new Message('a/b', 1, 'reply1'))
    unitTest.assertEqual(testMessage.reason[0].message, 'test1', 'test 1.1')
    unitTest.assertEqual(testMessage.reason.length, 2, 'test 1.2')
    // Test that a message is not matched twice
    testMessage = matchMessages.matchAndUpdateReplyMessage(new Message('a/b', 1, 'reply1'))
    unitTest.assertEqual(testMessage.reason[0].message, 'reply1', 'test 1.3')
    unitTest.assertEqual(testMessage.reason.length, 1, 'test 1.4')

    // Check that it does not match with wrong value
    matchMessages.addReceivedMessage(new Message('a/b/set', 2, 'test2'))
    testMessage = matchMessages.matchAndUpdateReplyMessage(new Message('a/b', 1, 'reply2'))
    unitTest.assertEqual(testMessage.reason[0].message, 'reply2', 'test 2.1')
    unitTest.assertEqual(testMessage.reason.length, 1, 'test 2.2')
    // Test that the message is still removed
    testMessage = matchMessages.matchAndUpdateReplyMessage(new Message('a/b', 2, 'reply2'))
    unitTest.assertEqual(testMessage.reason[0].message, 'reply2', 'test 2.3')
    unitTest.assertEqual(testMessage.reason.length, 1, 'test 2.4')
}

module.exports = matchTest
