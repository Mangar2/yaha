[
    {
        "description": "one node",
        "add": [["", "value1", "reason1"], ["", "value2", "reason2"]],
        "tests": [
            {
                "description": "no nodes",
                "addHistory": false,
                "addReason": false,
                "nodes": [],
                "expected": { "payload": [] }
            },
            {
                "description": "existing node, new value",
                "addHistory": false,
                "addReason": false,
                "nodes": [{ "topic": "", "value": "value1"}],
                "expected": {
                    "payload": [{ 
                        "topic": "", 
                        "value": "value2"
                    }]
                }
            },
            {
                "description": "existing node, new value with reason",
                "addHistory": false,
                "addReason": true,
                "nodes": [{ "topic": "", "value": "value1"}],
                "expected": {
                    "payload": [{ 
                        "topic": "", 
                        "value": "value2",
                        "time": "1970-01-01T00:00:00.000Z",
                        "reason": [
                            {
                                "message": "reason2",
                                "timestamp": "1970-01-01T00:00:00.000Z"
                            }
                        ] 
                    }]
                }
            },
            {
                "description": "existing node, new value with history",
                "addHistory": true,
                "addReason": false,
                "nodes": [{ "topic": "", "value": "value1"}],
                "expected": {
                    "payload": [{ 
                        "topic": "", 
                        "value": "value2",
                        "history": [
                            {
                                "time": "1970-01-01T00:00:00.000Z",
                                "value": "value1",
                                "reason": [
                                    {
                                        "message": "reason1",
                                        "timestamp": "1970-01-01T00:00:00.000Z"
                                    }
                                ]
                            }
                        ]
                    }]
                }
            },
            {
                "description": "existing node, existing value",
                "addHistory": false,
                "addReason": false,
                "nodes": [{ "topic": "", "value": "value2"}],
                "expected": {
                    "payload": []
                }
            },
            {
                "description": "existing node, existing value, different reason",
                "addHistory": false,
                "addReason": false,
                "nodes": [
                    { 
                        "topic": "", 
                        "value": "value2", 
                        "reason": [
                            {
                                "message": "reason2",
                                "timestamp": "1970-01-01T00:00:00.000Z"
                            }
                        ]
                    }
                ],
                "expected": {
                    "payload": []
                }
            }

        ]
    },
    {
        "description": "two nodes",
        "add": [["/a", "value1", "reason1"], ["/b", "value2", "reason2"]],
        "tests": [
            {
                "description": "first node",
                "addHistory": false,
                "addReason": false,
                "nodes": [{ "topic": "/a", "value": ""}],
                "expected": { "payload": [{ "topic": "/a", "value": "value1" }]}
            },
            {
                "description": "second node",
                "addHistory": false,
                "addReason": false,
                "nodes": [{ "topic": "/b", "value": ""}],
                "expected": { "payload": [{ "topic": "/b", "value": "value2" }]}
            },
            {
                "description": "two nodes",
                "addHistory": false,
                "addReason": false,
                "nodes": [{ "topic": "/a", "value": ""}, { "topic": "/b", "value": ""}],
                "expected": { "payload": [
                    { "topic": "/a", "value": "value1" }, 
                    { "topic": "/b", "value": "value2" }
                ]}
            }
        ]
    }
]