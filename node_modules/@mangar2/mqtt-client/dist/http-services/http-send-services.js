"use strict";
/**
 * @license
 * This software is licensed under the GNU LESSER GENERAL PUBLIC LICENSE Version 3. It is furnished
 * "as is", without any support, and with no warranty, express or implied, as to its usefulness for
 * any purpose.
 *
 * @author Volker Böhm
 * @copyright Copyright (c) 2020 Volker Böhm
 * @overview Provides functions to connect to the (http based) yaha mqtt broker
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.HttpSendServices = void 0;
const httpservice_1 = require("@mangar2/httpservice");
const publish_1 = require("../service/publish");
/**
 * Provides functions to send data to the broker
 */
class HttpSendServices {
    /**
     * Creates a new http service
     * @param port the port on which the server listens
     */
    constructor(brokerOptions) {
        this._httpClient = new httpservice_1.HttpClient(brokerOptions.host, brokerOptions.port, 'http');
        this._publish = new publish_1.Publish();
        this._publish.on('send', (httpMethod, path, headers, payload) => {
            return this._httpClient.sendv2({ path, method: httpMethod, headers, payload });
        });
    }
    /**
     * Sends an HTTP request.
     *
     * @param path - The path of the request.
     * @param method - The HTTP method of the request.
     * @param headers - The headers of the request.
     * @param payload - The payload of the request.
     * @returns A promise that resolves to the response of the request.
     */
    async send(path, headers, payload) {
        return this._httpClient.sendv2({ path, method: 'put', headers, payload });
    }
    /**
     * Publishes a message
     */
    async publish(token, message, serviceName, version = '1.0') {
        return this._publish.publish(token, message, serviceName, version);
    }
}
exports.HttpSendServices = HttpSendServices;
//# sourceMappingURL=http-send-services.js.map