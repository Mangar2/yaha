/**
 * @license
 * This software is licensed under the GNU LESSER GENERAL PUBLIC LICENSE Version 3. It is furnished
 * "as is", without any support, and with no warranty, express or implied, as to its usefulness for
 * any purpose.
 *
 * @author Volker Böhm
 * @copyright Copyright (c) 2023 Volker Böhm
 */
import { headers_t } from '@mangar2/mqtt-client/src/service/types';
import { LogFilter, LogPattern, IResult } from '@mangar2/mqtt-utils';
type LogSettings = any;
/**
 * @callback ProcessMessage
 * @param message the message received
 * @param dup flag signaling duplicates
 */
type ProcessMessage = (message: object, dup: boolean) => void;
/**
 * Calls a callback whenever a publish message arrives. Register the callback with
 * onPublish.on('publish', (message, dup) => {})
 * @param {number} listenerPort - The port on which the listener will be set up.
 * @param {LogSettings} logSettings - Settings for logging.
 * @param {number} [qos2PubrelTimeoutInSeconds=7200] - The timeout for QoS 2 publish release in seconds.
 */
export declare class OnPublish {
    _logFilter: LogFilter;
    private _callbacks;
    private _qos2Queue;
    private _qos2PubrelTimeoutInMilliseconds;
    constructor(logSettings: LogSettings, qos2PubrelTimeoutInSeconds?: number);
    /**
     * Handles incoming server requests.
     * @param {string} path - The request path.
     * @param {headers_t} headers - The headers of the request.
     * @param {string} payload - The payload of the request.
     * @param {ServerResponse} res - The response object.
     */
    handleRequest(path: string, headers: headers_t, payload: string): IResult;
    /**
     * Gets the log filter.
     * @returns {LogFilter} The log filter.
     */
    get logFilter(): LogFilter;
    /**
     * Registers a callback for a specific event.
     * @param {string} event - The event name.
     * @param {ProcessMessage} callback - The callback to be invoked.
     */
    on(event: string, callback: ProcessMessage): void;
    /**
     * Deletes old entries from the QoS 2 message queue.
     */
    private deleteOldQos2QueueEntries;
    /**
     * Handles incoming PUBREL requests.
     * @param {headers_t} headers HTTP headers of the request.
     * @param {ServerResponse} res The server response object.
     */
    onPubrel(headers: headers_t): IResult;
    /**
     * Remembers a message for handling QoS 2.
     * @param {string} topic The topic of the message.
     * @param {string} packetid The packet ID.
     */
    private rememberMessage;
    /**
     * Handles incoming publish requests. Calls the publish callback.
     * @param {headers_t} headers HTTP headers of the request.
     * @param {any} payload The payload of the request.
     * @param {ServerResponse} res The server response object.
     */
    onPublish(headers: headers_t, payload: any): IResult;
    /**
     * Handles log pattern changes.
     * @param {LogPattern[]} payload The new log patterns.
     * @param {ServerResponse} res The server response object.
     */
    onLog(payload: LogPattern[]): IResult;
}
export {};
