<!-- This file is generated by jsmddoc version 0.1 -->

# Abstract

Creates Mqtt message handler , receives , checks , transforms and foreward messages It supports the callbacks 'send' and 'publish'

Creates Mqtt message handler , receives , checks , transforms and foreward messages It supports the callbacks 'send' and 'publish'

## Contents

- [Meta](#Meta)
- [Type definitions](#Type-definitions)
- [Class Mqtt](#Class-Mqtt)
  - [Parameters](#Mqtt-Parameters)
  - [Methods](#Mqtt-Methods)
    - [getConnections](#getConnections)
    - [on](#on)
    - [processRequest](#processRequest)
    - [processSendMessage](#processSendMessage)
    - [restoreFromFile](#restoreFromFile)

## Meta

| | |
| --- | --- |
| **File** | checkdefinitions.js |
| **Abstract** | Creates Mqtt message handler , receives , checks , transforms and foreward messages It supports the callbacks 'send' and 'publish' |
| **Author** | Volker Böhm |
| **Copyright** | Copyright ( c ) 2020 Volker Böhm |
| **License** | This software is licensed under the GNU LESSER GENERAL PUBLIC LICENSE Version 3 . It is furnished "as is" , without any support , and with no warranty , express or implied , as to its usefulness for any purpose . |

| | |
| --- | --- |
| **File** | mqtt.js |
| **Abstract** | Creates Mqtt message handler , receives , checks , transforms and foreward messages It supports the callbacks 'send' and 'publish' |
| **Author** | Volker Böhm |
| **Copyright** | Copyright ( c ) 2020 Volker Böhm |
| **License** | This software is licensed under the GNU LESSER GENERAL PUBLIC LICENSE Version 3 . It is furnished "as is" , without any support , and with no warranty , express or implied , as to its usefulness for any purpose . |

## Type definitions

### httpReturn {Object}

| Name | Type | Description |
| ---- | ---- | ------- |
| `headers` | `Object` | header parameters | |
| `payload` | `Object` | payload data | |
| `statusCode` | `number` |  | |

## Callback definitions

### sendCallback


#### sendCallback Parameters

| Name | Type | Description |
| ---------- | ------------ | ----------------- |
| `host` | `string` | host name | |
| `port` | `number, string` | number | |
| `path` | `string` | http path for sending data | |
| `payload` | `Object` | payload ( body ) to send | |
| `headers` | `Object` | headers to send | |

### publishCallback


#### publishCallback Parameters

| Name | Type | Description |
| ---------- | ------------ | ----------------- |
| `message` | `Message` | message published | |

## Class Mqtt

`new Mqtt(configuration)`

Creates Mqtt message handler . It supports the callbacks 'send' and 'publish'

### Mqtt Parameters

| Name | Type | Description |
| ---------- | ------------ | ----------------- |
| `configuration` | `Object` | configuration options for the instance | |

#### configuration properties

| Name | Type | Description |
| ---------- | ------------ | ----------------- |
| `log` | `Object` | logging options | |
| `fileName` | `string` | filename for persistence | |
| `directory` | `string` | directory ( file path ) for persistence | |
| `replyTimeoutInMilliseconds` | `number` | timeout to wait for an answer of a http call , default 10 seconds | |
| `inFlightWindow` | `number` | amount of qos 1 and qos 2 messages send for the same topic at the same time , default 1 | |
| `pubrelTimeoutInMilliseconds` | `number` | timout to wait for a corresponding pubrel message , default one day | |
| `maxRetryCount` | `number` | amount of resend of messages before forcing a disconnect | |
| `maxQueuSize` | `number` | maximal amount of entries in a message queue | |

### Mqtt Methods

#### getConnections

`getConnections (clientId) => {httpReturn}`

Gets all connections or a single connection ( depends on path )

##### getConnections Parameters

| Name | Type | Description |
| ---------- | ------------ | ----------------- |
| `clientId` | `string` | id of the client or "" | |

##### getConnections returns

| Type | Description |
| ---- | ----------- |
| `httpReturn` | http return information |

#### on

`on (event, callback)`

Sets a callback .

##### on Parameters

| Name | Type | Description |
| ---------- | ------------ | ----------------- |
| `event` | `'send', 'publish'` | callback name | |
| `callback` | `sendCallback, publishCallback` | the callback for send and publish | |

##### on throws

| Type | Description |
| ---- | ----------- |
| `Error` | if the event is not supported |
| `Error` | if the callback is not 'function' |

#### processRequest

`processRequest (controls, payload, headers) => {httpReturn}`

Calls a connection interface

##### processRequest Parameters

| Name | Type | Description |
| ---------- | ------------ | ----------------- |
| `controls` | `string` | name of the mqtt controls to call ( connect , disconnect , . . . ) | |
| `payload` | `Object` | parameters for the interface ( see interfaces ) | |
| `headers` | `Object` | headers of the http message | |

##### processRequest returns

| Type | Description |
| ---- | ----------- |
| `httpReturn` | http return information |

#### processSendMessage

`async processSendMessage () => {number}`

Processes all messages to send and for each message calls the provided callback functions registered by calls to 'on' : 'send' ( host , port , action , payload , headers )

##### processSendMessage returns

| Type | Description |
| ---- | ----------- |
| `number` | amount of messages sent |

#### restoreFromFile

`restoreFromFile ()`

Restores the broker state from a file
