/**
 * ---------------------------------------------------------------------------------------------------
 * This software is licensed under the GNU LESSER GENERAL PUBLIC LICENSE Version 3. It is furnished
 * "as is", without any support, and with no warranty, express or implied, as to its usefulness for
 * any purpose.
 *
 * File:      mqttversion.js
 *
 * Author:      Volker Böhm
 * Copyright:   Volker Böhm
 * ---------------------------------------------------------------------------------------------------
 */

'use strict';

const mqttVersion = require('@mangar2/mqttversion');
const UnitTest = require('@mangar2/unittest');

var unitTest = new UnitTest(true);
let message = {topic: "a/b", value: 1, reason: [{message: "test"}]}

let publish = mqttVersion.publish('0.0', message, 1, true, true, 1);
let onPublish = mqttVersion.receive(publish.headers);
unitTest.assertTrue(publish.resultCheck(onPublish), "publish ver. 0.0")

publish = mqttVersion.publish('1.0', message, 1, true, true, 1);
onPublish = mqttVersion.receive(publish.headers);
unitTest.assertTrue(publish.resultCheck(onPublish), "publish ver. 1.0")

let pubrel = mqttVersion.pubrel('0.0', 1);
let onPubrel = mqttVersion.receive(pubrel.headers);
unitTest.assertTrue(pubrel.resultCheck(onPubrel), "pubrel ver. 0.0")

pubrel = mqttVersion.pubrel('1.0', 1);
onPubrel = mqttVersion.receive(pubrel.headers);
unitTest.assertTrue(pubrel.resultCheck(onPubrel), "pubrel ver. 1.0")

let subscribe = mqttVersion.subscribe('0.0', {"a/b": 1}, "client/test", 2);
let onSubscribe = mqttVersion.onSubscribe(subscribe.headers, [1]);
unitTest.assertTrue(subscribe.resultCheck(onSubscribe), "subscribe ver. 0.0")

subscribe = mqttVersion.subscribe('1.0', {"a/b": 1}, "client/test", 2);
onSubscribe = mqttVersion.onSubscribe(subscribe.headers);
unitTest.assertTrue(subscribe.resultCheck(onSubscribe), "subscribe ver. 1.0")

let connect = mqttVersion.connect('0.0', {"a/b": 1}, "client/test", 2);
let onConnect = mqttVersion.onConnect(connect.headers, [1]);
unitTest.assertTrue(connect.resultCheck(onConnect), "connect ver. 0.0")

connect = mqttVersion.connect('1.0', {"a/b": 1}, "client/test", 2);
onConnect = mqttVersion.onConnect(connect.headers);
unitTest.assertTrue(connect.resultCheck(onConnect), "connect ver. 1.0")

unitTest.showResult(6);
