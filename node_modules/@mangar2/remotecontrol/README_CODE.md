<!-- This file is generated by jsmddoc version 0.1 -->

# Abstract

Service to run operating system commands remotely and continuously send keep alive messages . It is used to include computers in the yaha home automation system . It can for example be used to shutdown a computer . Then switch of the power remotely once keep alive messages are no longer received . For security , it will only support remote commands configured in a configuration file , it will not directly process message content ( send as string ) on a remote computer .

## Contents

- [Meta](#Meta)
- [Type definitions](#Type-definitions)
- [Global Functions](#Global-functions)
  - [createQuestion](#createQuestion)
  - [getRef](#getRef)
  - [getValue](#getValue)
  - [readObjectFromStdin](#readObjectFromStdin)
  - [readText](#readText)
  - [readTreeFromStdin](#readTreeFromStdin)
  - [writeConfig](#writeConfig)
- [Class RunCommand](#Class-RunCommand)
  - [Parameters](#RunCommand-Parameters)
  - [Methods](#RunCommand-Methods)
    - [on](#on)
    - [processMessage](#processMessage)

## Meta

| | |
| --- | --- |
| **File** | remotecontrol.js |
| **Abstract** | Service to run operating system commands remotely and continuously send keep alive messages . It is used to include computers in the yaha home automation system . It can for example be used to shutdown a computer . Then switch of the power remotely once keep alive messages are no longer received . For security , it will only support remote commands configured in a configuration file , it will not directly process message content ( send as string ) on a remote computer . |
| **Author** | Volker Böhm |
| **Copyright** | Copyright ( c ) 2020 Volker Böhm |
| **License** | This software is licensed under the GNU LESSER GENERAL PUBLIC LICENSE Version 3 . It is furnished "as is" , without any support , and with no warranty , express or implied , as to its usefulness for any purpose . |

## Type definitions

### Command {Object}

Command configuration structure
| Name | Type | Description |
| ---- | ---- | ------- |
| `name` | `string` | name of the command ( must be unique across all commands ) | |
| `command` | `string` | command to execute | |
| `delayInSeconds` | `number` | delay in seconds to wait before executing the command | |
| `value` | `string` | state value sended as a return message when executing the command | |

## Global functions

### createQuestion

`createQuestion (variableName, type, description, defaultValue)`

Creates a question string to ask for a variable value

#### createQuestion Parameters

| Name | Type | Description |
| ---------- | ------------ | ----------------- |
| `variableName` | `string` | name of a variable to ask for | |
| `type` | `string` | variable type definition ( as provided in JSON schemata ) | |
| `description` | `string` | variable description | |
| `defaultValue` | `string` | value of the variable , if no variable is entered | |

### getRef

`getRef (schema, ref)`

Gets the reference of a schema

#### getRef Parameters

| Name | Type | Description |
| ---------- | ------------ | ----------------- |
| `schema` | `Object` | JSON schema definition | |
| `ref` | `string` | reference string | |

### getValue

`getValue (enteredValue, defaultValue) => {string}`

Returns enteredValue or defaultValue , if entered value is the empty string

#### getValue Parameters

| Name | Type | Description |
| ---------- | ------------ | ----------------- |
| `enteredValue` | `string` | value entered | |
| `defaultValue` | `string` | default value | |

#### getValue returns

| Type | Description |
| ---- | ----------- |
| `string` |  |

### readObjectFromStdin

`async readObjectFromStdin (propertyNames, schema, defaultValues) => {Object}`

Reads several strings from stdin

#### readObjectFromStdin Parameters

| Name | Type | Description |
| ---------- | ------------ | ----------------- |
| `propertyNames` | `Array.<string>` | list of property names to read | |
| `schema` | `Object` | JSON schema with an object definition and a property section containing all provided propertyNames | |
| `defaultValues` | `Object` | default value structure matching the provided schema | |

#### readObjectFromStdin returns

| Type | Description |
| ---- | ----------- |
| `Object` | list of read values |

### readText

`async readText (question) => {string}`

Prints a query string and reads a line from stdin

#### readText Parameters

| Name | Type | Description |
| ---------- | ------------ | ----------------- |
| `question` | `string` | question string before entering the text | |

#### readText returns

| Type | Description |
| ---- | ----------- |
| `string` | line read |

### readTreeFromStdin

`async readTreeFromStdin (propertyNames, schema, defaultValues) => {Object}`

Reads several strings from stdin to an object tree

#### readTreeFromStdin Parameters

| Name | Type | Description |
| ---------- | ------------ | ----------------- |
| `propertyNames` | `Array.<string>` | list of property names to read | |
| `schema` | `Object` | JSON schema with an object definition and a property section containing all provided propertyNames | |
| `defaultValues` | `Object` | default value structure matching the provided schema | |

#### readTreeFromStdin returns

| Type | Description |
| ---- | ----------- |
| `Object` | Read values |

### writeConfig

`writeConfig (configuration, fileName)`

Write the configuration to a file

#### writeConfig Parameters

| Name | Type | Description |
| ---------- | ------------ | ----------------- |
| `configuration` | `Object` | configuration to save | |
| `fileName` | `string` | name of the file | |

## Class RunCommand

`new RunCommand(options)`

Runs a configured operating-system command based on a message received

### RunCommand Parameters

| Name | Type | Description |
| ---------- | ------------ | ----------------- |
| `options` | `Object` | configuration options | |

#### options properties

| Name | Type | Description |
| ---------- | ------------ | ----------------- |
| `commands` | `Command, Array.<Command>` | command configuration | |
| `clientId` | `string` | id of the client running the command | |

### RunCommand Methods

#### on

`on (event, callback)`

Sets a callback .

##### on Parameters

| Name | Type | Description |
| ---------- | ------------ | ----------------- |
| `event` | `string` | event name ( not case sensitive ) for the callback | |
| `callback` | `function` | function ( . . . parameter ) | |

##### on throws

| Type | Description |
| ---- | ----------- |
| `Error` | if the event is not supported |
| `Error` | if the callback is not 'function' |

#### processMessage

`async processMessage (message)`

Excecutes a command coming from a message . The command is taken from the value

##### processMessage Parameters

| Name | Type | Description |
| ---------- | ------------ | ----------------- |
| `message` | `Message` | message received | |

#### message properties

| Name | Type | Description |
| ---------- | ------------ | ----------------- |
| `value` | `string` | command name . If it is 'stop' , the last command will be cancelled | |
| `topic` | `string` | topic of the command . A new message will terminate the ( delayed ) command of the last call with the same topic | |
