<!-- Generated by documentation.js. Update this documentation by updating the source code. -->

### Table of Contents

-   [Rules][1]
    -   [Parameters][2]
    -   [Examples][3]
    -   [rules][4]
    -   [invalidRules][5]
    -   [invalidateRule][6]
        -   [Parameters][7]
-   [ProcessRule][8]
    -   [Parameters][9]
    -   [variables][10]
        -   [Parameters][11]
    -   [setVariable][12]
        -   [Parameters][13]
    -   [date][14]
    -   [date][15]
        -   [Parameters][16]
    -   [determineNeededVariables][17]
        -   [Parameters][18]
    -   [check][19]
        -   [Parameters][20]

## 

**Meta**

-   **copyright**: Copyright (c) 2020 Volker Böhm

-   **author**: Volker Böhm
-   **license**: This software is licensed under the GNU LESSER GENERAL PUBLIC LICENSE Version 3. It is furnished
    "as is", without any support, and with no warranty, express or implied, as to its usefulness for
    any purpose.

## 

**Meta**

-   **copyright**: Copyright (c) 2020 Volker Böhm

-   **author**: Volker Böhm
-   **license**: This software is licensed under the GNU LESSER GENERAL PUBLIC LICENSE Version 3. It is furnished
    "as is", without any support, and with no warranty, express or implied, as to its usefulness for
    any purpose.

## Rules

Creates an object holding automation rules

### Parameters

-   `rulesTree` **[Object][21]** rules tree
-   `check` **CheckInput** definition to check the validity of a rule

### Examples

```javascript
const rulesTree =
 {
      location1: {
          rules: {
              rule1: {
                  title: 'hello'
              },
              rule2: {
                  title: 'world'
              }
          }
      },
      location2: {
          rule1: {
              error: 'faulty rule'
          }
      }
  }
const checkRule = new CheckInput({ type: 'object', properties: { title: { type: string } }, required: ['title'] })
const rules = new Rules(rulesTree, checkRules)
console.log(rules.rules.length) // prints 1, we have one correct rule
console.log(rules.invalidRules[0].messages) // prints the error messages for rule 'location2'
```

### rules

Get the valid rules list

Returns **[Array][22]&lt;[Object][21]>** array of rules

### invalidRules

Get the invalid rules list

Returns **[Array][22]&lt;[Object][21]>** array of invalid rules als { ruleName, messages }

### invalidateRule

Invalidates a rule, because it generates an error

#### Parameters

-   `name` **[string][23]** name of the rule to invalidate
-   `messages` **[Array][22]&lt;[string][23]>?** error messages (optional, default `[]`)

## 

**Meta**

-   **copyright**: Copyright (c) 2020 Volker Böhm

-   **author**: Volker Böhm
-   **license**: This software is licensed under the GNU LESSER GENERAL PUBLIC LICENSE Version 3. It is furnished
    "as is", without any support, and with no warranty, express or implied, as to its usefulness for
    any purpose.

## ProcessRule

Processes rules based on a set of variables

### Parameters

-   `variables` **[Object][21]** key/value map where key is the variable name (usually a topic string) (optional, default `{}`)
-   `date` **[Date][24]** current date (optional, default `now`)
-   `longitude` **[number][25]** geographical longitued poistion of the automation target in degrees (optional, default `51.476852`)
-   `latitude` **[number][25]** geographical latitued poistion of the automation target in degrees (optional, default `-0.000500`)

### variables

Sets all variables

#### Parameters

-   `variables` **[Object][21]** key/value object containing a list of variables

### setVariable

Sets a single variable

#### Parameters

-   `name` **[string][23]** name of the variable to set
-   `value` **any** value of the variable to set

### date

Gets the current date/time

Returns **[Date][24]** current date/time

### date

Sets the current date/time

#### Parameters

-   `date` **[Date][24]** current date

### determineNeededVariables

Gets a list of needed variables for the rule

#### Parameters

-   `rule` **[Object][21]** rule to check

### check

Processes a rule and if the rule demands, create a message

#### Parameters

-   `rule` **[Object][21]** rule to check
-   `events` **[Object][21]?** map {topic: timestamp} of events


-   Throws **[Error][26]** on error in the decision rule

Returns **{messages: [Array][22]&lt;Message>, usedVariables}** Array of messages and object of variables used.

[1]: #rules

[2]: #parameters

[3]: #examples

[4]: #rules-1

[5]: #invalidrules

[6]: #invalidaterule

[7]: #parameters-1

[8]: #processrule

[9]: #parameters-2

[10]: #variables

[11]: #parameters-3

[12]: #setvariable

[13]: #parameters-4

[14]: #date

[15]: #date-1

[16]: #parameters-5

[17]: #determineneededvariables

[18]: #parameters-6

[19]: #check

[20]: #parameters-7

[21]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object

[22]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array

[23]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String

[24]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Date

[25]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number

[26]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Error
