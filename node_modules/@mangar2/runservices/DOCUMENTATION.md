<!-- This file is generated by jsmddoc version 0.1 -->

# Abstract

Runs any yaha service as an mqttclient . Services needs to bring the following interface :

- A "prepare ( config , [ serviceObject = null ] ) " function - returning a service object and initializes it
- A getSubscriptions method to get a list of topics to subscribe { topic : QoS , topic : QoS , . . . }
- A handle message method to handle a mqtt message sent to the service
- Optional - a on ( 'publish' , callback ) method to register a publish message callback
- Optional - a close ( ) function to be called to close/stop the service´s background tasks
- Optional - a run ( ) function to start background tasks

## Contents

- [Meta](#Meta)
- [Global Functions](#Global-functions)
  - [_registerBackgroundTasks](#_registerBackgroundTasks)
  - [_registerSubscriptions](#_registerSubscriptions)
  - [loadConfiguration](#loadConfiguration)

## Meta

| | |
| --- | --- |
| **File** | runservices.js |
| **Abstract** | Runs any yaha service as an mqttclient . Services needs to bring the following interface :

- A "prepare ( config , [ serviceObject = null ] ) " function - returning a service object and initializes it
- A getSubscriptions method to get a list of topics to subscribe { topic : QoS , topic : QoS , . . . }
- A handle message method to handle a mqtt message sent to the service
- Optional - a on ( 'publish' , callback ) method to register a publish message callback
- Optional - a close ( ) function to be called to close/stop the service´s background tasks
- Optional - a run ( ) function to start background tasks |
| **Author** | Volker Böhm |
| **Copyright** | Copyright ( c ) 2020 Volker Böhm |
| **License** | This software is licensed under the GNU LESSER GENERAL PUBLIC LICENSE Version 3 . It is furnished "as is" , without any support , and with no warranty , express or implied , as to its usefulness for any purpose . |

## Global functions

### _registerBackgroundTasks

`_registerBackgroundTasks (mqttClient, registeredObject, serviceName)`

Connects the background task functionality of a registered object with the mqttClient handlers

#### _registerBackgroundTasks Parameters

| Name | Type | Description |
| ---------- | ------------ | ----------------- |
| `mqttClient` | `MQTTClient` | mqtt client object managing the services | |
| `registeredObject` | `Object` | object in registration | |
| `serviceName` | `string` | name of the service to start | |

### _registerSubscriptions

`_registerSubscriptions (mqttClient, registeredObject, serviceName, prepare)`

Registers subscriptions

#### _registerSubscriptions Parameters

| Name | Type | Description |
| ---------- | ------------ | ----------------- |
| `mqttClient` | `MqttClient` | client providing mqtt services | |
| `registeredObject` | `Object` | registered service object | |
| `serviceName` | `string` | name of the service to start | |
| `prepare` | `function` | function to call on update message | |

### loadConfiguration

`loadConfiguration () => {Object}`

Loads and sanitizes the configuration file , using "yahaconfig . json" as default name , if the process parameters do not include a configuration file name

#### loadConfiguration returns

| Type | Description |
| ---- | ----------- |
| `Object` | configuration object |
