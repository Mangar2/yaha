/**
 * @license
 * This software is licensed under the GNU LESSER GENERAL PUBLIC LICENSE Version 3. It is furnished
 * "as is", without any support, and with no warranty, express or implied, as to its usefulness for
 * any purpose.
 *
 * @author Volker Böhm
 * @copyright Copyright (c) 2020 Volker Böhm
 */

'use strict'

const UnitTest = require('@mangar2/unittest')
const TopicMatch = require('@mangar2/topicmatch')

const pattern = [
    'ground/wardrobe/main/brightness sensor/brightness/+',
    'ground/wardrobe/main/motion sensor/detection state/+',
    'ground/wardrobe/main/temperature and humidity sensor/read error code/+',
    'ground/wardrobe/main/temperature and humidity sensor/humidity in percent/+',
    'ground/wardrobe/main/temperature and humidity sensor/temperature in celsius/+',
    'ground/wardrobe/main/light/light on time in seconds/+',
    'ground/wardrobe/main/light/light activation brightness/+',
    'ground/wardrobe/main/temperature and humidity sensor/pin/+',
    'ground/wardrobe/main/system/error level/+',
    'ground/wardrobe/main/light/target intensity/+',
    'ground/wardrobe/main/light/light start voltage/+',
    'ground/wardrobe/main/light/dimming delay in milliseconds/+',
    'ground/wardrobe/main/Arduino base settings/I2C server address/+',
    'ground/wardrobe/main/Arduino base settings/I2C client address/+',
    'ground/wardrobe/main/light/light on time/+',
    'ground/wardrobe/main/i2c/status/temperature/+',
    'ground/wardrobe/main/i2c/status/version/+',
    'ground/hallway/center/brightness sensor/brightness/+',
    'ground/hallway/center/motion sensor/detection state/+',
    'ground/hallway/center/temperature and humidity sensor/read error code/+',
    'ground/hallway/center/temperature and humidity sensor/humidity in percent/+',
    'ground/hallway/center/temperature and humidity sensor/temperature in celsius/+',
    'ground/hallway/center/light/light on time in seconds/+',
    'ground/hallway/center/light/light activation brightness/+',
    'ground/hallway/center/temperature and humidity sensor/pin/+',
    'ground/hallway/center/system/error level/+',
    'ground/hallway/center/light/target intensity/+',
    'ground/hallway/center/light/light start voltage/+',
    'ground/hallway/center/light/dimming delay in milliseconds/+',
    'ground/hallway/center/Arduino base settings/I2C server address/+',
    'ground/hallway/center/Arduino base settings/I2C client address/+',
    'ground/hallway/center/light/light on time/+',
    'ground/hallway/center/i2c/status/temperature/+',
    'ground/hallway/center/i2c/status/version/+',
    'ground/hallway/wall/brightness sensor/brightness/+',
    'ground/hallway/wall/motion sensor/detection state/+',
    'ground/hallway/wall/temperature and humidity sensor/read error code/+',
    'ground/hallway/wall/temperature and humidity sensor/humidity in percent/+',
    'ground/hallway/wall/temperature and humidity sensor/temperature in celsius/+',
    'ground/hallway/wall/light/light on time in seconds/+',
    'ground/hallway/wall/light/light activation brightness/+',
    'ground/hallway/wall/temperature and humidity sensor/pin/+',
    'ground/hallway/wall/system/error level/+',
    'ground/hallway/wall/light/target intensity/+',
    'ground/hallway/wall/light/light start voltage/+',
    'ground/hallway/wall/light/dimming delay in milliseconds/+',
    'ground/hallway/wall/Arduino base settings/I2C server address/+',
    'ground/hallway/wall/Arduino base settings/I2C client address/+',
    'ground/hallway/wall/light/light on time/+',
    'ground/hallway/wall/i2c/status/temperature/+',
    'ground/hallway/wall/i2c/status/version/+',
    '$SYS/central/brightness sensor/brightness/+',
    '$SYS/central/motion sensor/detection state/+',
    '$SYS/central/temperature and humidity sensor/read error code/+',
    '$SYS/central/temperature and humidity sensor/humidity in percent/+',
    '$SYS/central/temperature and humidity sensor/temperature in celsius/+',
    '$SYS/central/light/light on time in seconds/+',
    '$SYS/central/light/light activation brightness/+',
    '$SYS/central/temperature and humidity sensor/pin/+',
    '$SYS/central/system/error level/+',
    '$SYS/central/light/target intensity/+',
    '$SYS/central/light/light start voltage/+',
    '$SYS/central/light/dimming delay in milliseconds/+',
    '$SYS/central/Arduino base settings/I2C server address/+',
    '$SYS/central/Arduino base settings/I2C client address/+',
    '$SYS/central/light/light on time/+',
    '$SYS/central/i2c/status/temperature/+',
    '$SYS/central/i2c/status/version/+',
    'ground/livingroom/fs20/switch/amplifier/+',
    'ground/livingroom/fs20/switch/appletv/+',
    'ground/wardrobe/fs20/switch/floor heating/+',
    'outdoor/garden/fs20/switch/brook/+',
    'outdoor/garden/fs20/switch/light stonefield/+',
    'outdoor/garden/fs20/switch/light pathway/+',
    'ground/wardrobe/i2c/switch/network switch/+',
    'ground/wardrobe/i2c/switch/charge/+',
    'ground/wardrobe/i2c/switch/monitor/+',
    'ground/wardrobe/i2c/switch/backup/+',
    'ground/wardrobe/i2c/switch/server/+',
    'ground/wardrobe/i2c/switch/internet/+',
    '$SYS/serialdevice/#',
    '$SYS/serialDevice/update',
    '+/+/+/arduino base settings/device address/set',
    '+/+/+/light/light activation brightness/set',
    '+/+/+/time of day/set',
    '+/+/+/light/evening brightness/set',
    '+/+/+/arduino base settings/reporting delay in seconds/set',
    '+/+/+/light/light full on voltage/set',
    '+/+/+/light/day brightness/set',
    '+/+/+/light/light full on brightness sensor value/set',
    '+/+/+/light/initial light on time in seconds/set',
    '+/+/+/light/increase light on time in seconds/set',
    '+/+/+/light/max light on time in seconds/set',
    '+/+/+/light/night brightness/set',
    '+/+/+/light/light start voltage/set',
    '+/+/+/light/dimming delay in milliseconds/set',
    '+/+/+/light/run light adjustment/set',
    '+/+/+/roller shutter/roller shutter key/set',
    '+/+/+/arduino base settings/router address/set',
    '+/+/+/roller shutter/time to close roller/set',
    '+/+/+/light/light on time/set',
    '+/+/+/light/light false off time adjustment/set',
    '+/+/+/switch/status/set',
    '+/+/+/arduino base settings/software version/set',
    'cellar/boilerroom/switches/switch/camera/+',
    'outdoor/garden/main/switch/socket stonefield/+',
    'outdoor/garden/main/switch/light stairs/+',
    'outdoor/garden/main/switch/pump/+',
    'outdoor/garden/main/switch/socket parkingplace/+'
]

const topics = [
    'ground/wardrobe/main/brightness sensor/brightness',
    'ground/wardrobe/main/motion sensor/detection state',
    'ground/wardrobe/main/temperature and humidity sensor/read error code',
    'ground/wardrobe/main/temperature and humidity sensor/humidity in percent',
    'ground/wardrobe/main/temperature and humidity sensor/temperature in celsius',
    'ground/wardrobe/main/light/light on time in seconds',
    'ground/wardrobe/main/light/light activation brightness',
    'ground/wardrobe/main/temperature and humidity sensor/pin',
    'ground/wardrobe/main/system/error level',
    'ground/wardrobe/main/light/target intensity',
    'ground/wardrobe/main/light/light start voltage',
    'ground/wardrobe/main/light/dimming delay in milliseconds',
    'ground/wardrobe/main/Arduino base settings/I2C server address',
    'ground/wardrobe/main/Arduino base settings/I2C client address',
    'ground/wardrobe/main/light/light on time',
    'ground/wardrobe/main/i2c/status/temperature',
    'ground/wardrobe/main/i2c/status/version',
    'ground/hallway/center/brightness sensor/brightness',
    'ground/hallway/center/motion sensor/detection state',
    'ground/hallway/center/temperature and humidity sensor/read error code',
    'ground/hallway/center/temperature and humidity sensor/humidity in percent',
    'ground/hallway/center/temperature and humidity sensor/temperature in celsius',
    'ground/hallway/center/light/light on time in seconds',
    'ground/hallway/center/light/light activation brightness',
    'ground/hallway/center/temperature and humidity sensor/pin',
    'ground/hallway/center/system/error level',
    'ground/hallway/center/light/target intensity',
    'ground/hallway/center/light/light start voltage',
    'ground/hallway/center/light/dimming delay in milliseconds',
    'ground/hallway/center/Arduino base settings/I2C server address',
    'ground/hallway/center/Arduino base settings/I2C client address',
    'ground/hallway/center/light/light on time',
    'ground/hallway/center/i2c/status/temperature',
    'ground/hallway/center/i2c/status/version',
    'ground/hallway/wall/brightness sensor/brightness',
    'ground/hallway/wall/motion sensor/detection state',
    'ground/hallway/wall/temperature and humidity sensor/read error code',
    'ground/hallway/wall/temperature and humidity sensor/humidity in percent',
    'ground/hallway/wall/temperature and humidity sensor/temperature in celsius',
    'ground/hallway/wall/light/light on time in seconds',
    'ground/hallway/wall/light/light activation brightness',
    'ground/hallway/wall/temperature and humidity sensor/pin',
    'ground/hallway/wall/system/error level',
    'ground/hallway/wall/light/target intensity',
    'ground/hallway/wall/light/light start voltage',
    'ground/hallway/wall/light/dimming delay in milliseconds',
    'ground/hallway/wall/Arduino base settings/I2C server address',
    'ground/hallway/wall/Arduino base settings/I2C client address',
    'ground/hallway/wall/light/light on time',
    'ground/hallway/wall/i2c/status/temperature',
    'ground/hallway/wall/i2c/status/version',
    '$SYS/central/brightness sensor/brightness',
    '$SYS/central/motion sensor/detection state',
    '$SYS/central/temperature and humidity sensor/read error code',
    '$SYS/central/temperature and humidity sensor/humidity in percent',
    '$SYS/central/temperature and humidity sensor/temperature in celsius',
    '$SYS/central/light/light on time in seconds',
    '$SYS/central/light/light activation brightness',
    '$SYS/central/temperature and humidity sensor/pin',
    '$SYS/central/system/error level',
    '$SYS/central/light/target intensity',
    '$SYS/central/light/light start voltage',
    '$SYS/central/light/dimming delay in milliseconds',
    '$SYS/central/Arduino base settings/I2C server address',
    '$SYS/central/Arduino base settings/I2C client address',
    '$SYS/central/light/light on time',
    '$SYS/central/i2c/status/temperature',
    '$SYS/central/i2c/status/version',
    'ground/livingroom/fs20/switch/amplifier',
    'ground/livingroom/fs20/switch/appletv',
    'ground/wardrobe/fs20/switch/floor heating',
    'outdoor/garden/fs20/switch/brook',
    'outdoor/garden/fs20/switch/light stonefield',
    'outdoor/garden/fs20/switch/light pathway',
    'ground/wardrobe/i2c/switch/network switch',
    'ground/wardrobe/i2c/switch/charge',
    'ground/wardrobe/i2c/switch/monitor',
    'ground/wardrobe/i2c/switch/backup',
    'ground/wardrobe/i2c/switch/server',
    'ground/wardrobe/i2c/switch/internet',
    '$SYS/serialdevice',
    '$SYS/serialDevice/update',
    'ground/wardrobe/main/brightness sensor/brightness/set',
    'ground/wardrobe/main/motion sensor/detection state/set',
    'ground/wardrobe/main/temperature and humidity sensor/read error code/set',
    'ground/wardrobe/main/temperature and humidity sensor/humidity in percent/set',
    'ground/wardrobe/main/temperature and humidity sensor/temperature in celsius/set',
    'ground/wardrobe/main/light/light on time in seconds/set',
    'ground/wardrobe/main/light/light activation brightness/set',
    'ground/wardrobe/main/temperature and humidity sensor/pin/set',
    'ground/wardrobe/main/system/error level/set',
    'ground/wardrobe/main/light/target intensity/set',
    'ground/wardrobe/main/light/light start voltage/set',
    'ground/wardrobe/main/light/dimming delay in milliseconds/set',
    'ground/wardrobe/main/Arduino base settings/I2C server address/set',
    'ground/wardrobe/main/Arduino base settings/I2C client address/set',
    'ground/wardrobe/main/light/light on time/set',
    'ground/wardrobe/main/i2c/status/temperature/set',
    'ground/wardrobe/main/i2c/status/version/set',
    'ground/hallway/center/brightness sensor/brightness/set',
    'ground/hallway/center/motion sensor/detection state/set',
    'ground/hallway/center/temperature and humidity sensor/read error code/set',
    'ground/hallway/center/temperature and humidity sensor/humidity in percent/set',
    'ground/hallway/center/temperature and humidity sensor/temperature in celsius/set',
    'ground/hallway/center/light/light on time in seconds/set',
    'ground/hallway/center/light/light activation brightness/set',
    'ground/hallway/center/temperature and humidity sensor/pin/set',
    'ground/hallway/center/system/error level/set',
    'ground/hallway/center/light/target intensity/set',
    'ground/hallway/center/light/light start voltage/set',
    'ground/hallway/center/light/dimming delay in milliseconds/set',
    'ground/hallway/center/Arduino base settings/I2C server address/set',
    'ground/hallway/center/Arduino base settings/I2C client address/set',
    'ground/hallway/center/light/light on time/set',
    'ground/hallway/center/i2c/status/temperature/set',
    'ground/hallway/center/i2c/status/version/set',
    'ground/hallway/wall/brightness sensor/brightness/set',
    'ground/hallway/wall/motion sensor/detection state/set',
    'ground/hallway/wall/temperature and humidity sensor/read error code/set',
    'ground/hallway/wall/temperature and humidity sensor/humidity in percent/set',
    'ground/hallway/wall/temperature and humidity sensor/temperature in celsius/set',
    'ground/hallway/wall/light/light on time in seconds/set',
    'ground/hallway/wall/light/light activation brightness/set',
    'ground/hallway/wall/temperature and humidity sensor/pin/set',
    'ground/hallway/wall/system/error level/set',
    'ground/hallway/wall/light/target intensity/set',
    'ground/hallway/wall/light/light start voltage/set',
    'ground/hallway/wall/light/dimming delay in milliseconds/set',
    'ground/hallway/wall/Arduino base settings/I2C server address/set',
    'ground/hallway/wall/Arduino base settings/I2C client address/set',
    'ground/hallway/wall/light/light on time/set',
    'ground/hallway/wall/i2c/status/temperature/set',
    'ground/hallway/wall/i2c/status/version/set',
    '$SYS/central/brightness sensor/brightness/set',
    '$SYS/central/motion sensor/detection state/set',
    '$SYS/central/temperature and humidity sensor/read error code/set',
    '$SYS/central/temperature and humidity sensor/humidity in percent/set',
    '$SYS/central/temperature and humidity sensor/temperature in celsius/set',
    '$SYS/central/light/light on time in seconds/set',
    '$SYS/central/light/light activation brightness/set',
    '$SYS/central/temperature and humidity sensor/pin/set',
    '$SYS/central/system/error level/set',
    '$SYS/central/light/target intensity/set',
    '$SYS/central/light/light start voltage/set',
    '$SYS/central/light/dimming delay in milliseconds/set',
    '$SYS/central/Arduino base settings/I2C server address/set',
    '$SYS/central/Arduino base settings/I2C client address/set',
    '$SYS/central/light/light on time/set',
    '$SYS/central/i2c/status/temperature/set',
    '$SYS/central/i2c/status/version/set',
    'ground/livingroom/fs20/switch/amplifier/set',
    'ground/livingroom/fs20/switch/appletv/set',
    'ground/wardrobe/fs20/switch/floor heating/set',
    'outdoor/garden/fs20/switch/brook/set',
    'outdoor/garden/fs20/switch/light stonefield/set',
    'outdoor/garden/fs20/switch/light pathway/set',
    'ground/wardrobe/i2c/switch/network switch/set',
    'ground/wardrobe/i2c/switch/charge/set',
    'ground/wardrobe/i2c/switch/monitor/set',
    'ground/wardrobe/i2c/switch/backup/set',
    'ground/wardrobe/i2c/switch/server/set',
    'ground/wardrobe/i2c/switch/internet/set'
]

function perftest () {
    const topicMatch = new TopicMatch()
    topicMatch.addPattern(pattern, 1)
    let result = 0
    for (const topic of topics) {
        const value = topicMatch.getFirstMatch(topic)
        if (value !== undefined) {
            result += value
        }
    }
    return result
}

function runOften (count) {
    const unitTest = new UnitTest()
    const startTime = (new Date()).getTime()
    unitTest.assertEqual(perftest(), 81, 'result is ok')
    console.log('start run %s times', count)
    for (let i = 0; i < count; i++) {
        perftest()
    }
    const stopTime = (new Date()).getTime()
    unitTest.assertTrue((stopTime - startTime) < 1000)
    console.log('run finised, took %s seconds', (stopTime - startTime) / 1000)
}

runOften(1000)
