<!-- This file is generated by jsmddoc version 0.1 -->

# Abstract

Provides an object to connect openzwave to the yaha mqtt-like broker

## Contents

- [Meta](#Meta)
- [Type definitions](#Type-definitions)
- [Global Functions](#Global-functions)
  - [prepare](#prepare)
- [Class ZwaveController](#Class-ZwaveController)
  - [Parameters](#ZwaveController-Parameters)
  - [Methods](#ZwaveController-Methods)
    - [addDevice](#addDevice)
    - [close](#close)
    - [logNode](#logNode)
    - [on](#on)
    - [publishValue](#publishValue)
    - [publishValueChange](#publishValueChange)
    - [registerZwaveCallbacks](#registerZwaveCallbacks)
    - [removeFailedNode](#removeFailedNode)
    - [requestConfigParametersForAllNodes](#requestConfigParametersForAllNodes)
    - [setDeviceConfiguration](#setDeviceConfiguration)
    - [setNodeInfo](#setNodeInfo)
    - [setValue](#setValue)
- [Class ZwaveDevices](#Class-ZwaveDevices)
  - [Parameters](#ZwaveDevices-Parameters)
  - [Methods](#ZwaveDevices-Methods)
    - [topicToZwaveId](#topicToZwaveId)
- [Class ZwaveService](#Class-ZwaveService)
  - [Parameters](#ZwaveService-Parameters)
  - [Methods](#ZwaveService-Methods)
    - [_setValueIdToDevices](#_setValueIdToDevices)
    - [close](#close)
    - [getSubscriptions](#getSubscriptions)
    - [handleMessage](#handleMessage)
    - [on](#on)
    - [run](#run)
    - [setDeviceConfiguration](#setDeviceConfiguration)

## Meta

| | |
| --- | --- |
| **File** | index.js |
| **Abstract** | Provides an object to connect openzwave to the yaha mqtt-like broker |
| **Author** | Volker Böhm |
| **Copyright** | Copyright ( c ) 2020 Volker Böhm |
| **License** | This software is licensed under the GNU LESSER GENERAL PUBLIC LICENSE Version 3 . It is furnished "as is" , without any support , and with no warranty , express or implied , as to its usefulness for any purpose . |

## Type definitions

### ZwaveValue {Object}

| Name | Type | Description |
| ---- | ---- | ------- |
| `node_id` | `number` |  |  | id of the zwave node | |
| `class_id` | `number` |  |  | id of the zwave parameter class | |
| `label` | `string` |  |  | label of the value changed | |
| `instance` | `number` | optional | 1 | index of device instance for a multi instance zwave device | |
| `index` | `number` | optional | 0 | index of the feature for a multi-feature device class | |

### DeviceConfig {Object}

| Name | Type | Description |
| ---- | ---- | ------- |
| `topic` | `string` |  |  | device topic | |
| `node_id` | `number` |  |  | id of the zwave node | |
| `class_id` | `number` | optional |  | id of the zwave parameter class | |
| `instance` | `number` | optional |  | index of device instance for a multi instance zwave device | |
| `index` | `number` | optional |  | index of the feature for a multi-feature device class | |
| `type` | `string` | optional | 'bool' | type of the parameter ( e . g . 'bool' ) | |

## Global functions

### prepare

`prepare (config, zwave) => {Zwave}`

Instantiates exactly one zwave object

#### prepare Parameters

| Name | Type | Attribute | Default | Description |
| ---------- | ------------ | ------------ | ------------ | ----------------- |
| `config` | `Object` |  |  | automation configuration | |
| `zwave` | `Zwave` | optional | null | existing zwave class | |

#### prepare returns

| Type | Description |
| ---- | ----------- |
| `Zwave` | the prepared zwave object |

## Class ZwaveController

`new ZwaveController(config)`

Constructs a new zwave controller and binds it to an input device

### ZwaveController Parameters

| Name | Type | Description |
| ---------- | ------------ | ----------------- |
| `config` | `object` | zwave controller configuration | |

#### config properties

| Name | Type | Description |
| ---------- | ------------ | ----------------- |
| `device` | `string` | zwave controller device ( COM port ) | |
| `topic` | `string` | zwave controller topic to send messages | |

### ZwaveController Methods

#### addDevice

`addDevice ()`

Enable adding devices

#### close

`async close ()`

Disconnects from usb device

#### logNode

`logNode (nodeId)`

Logs the infos of a zwave device node to console

##### logNode Parameters

| Name | Type | Description |
| ---------- | ------------ | ----------------- |
| `nodeId` | `string` | id of the zwave device node | |

#### on

`on (event, callback)`

Sets a callback .

##### on Parameters

| Name | Type | Description |
| ---------- | ------------ | ----------------- |
| `event` | `string` | event name ( not case sensitive ) for the callback | |
| `callback` | `function` | ( parameter ) | |

##### on throws

| Type | Description |
| ---- | ----------- |
| `Error` | if the event is not supported |
| `Error` | if the callback is not 'function' |

#### publishValue

`publishValue (nodeId, zwaveValue, reasonString)`

Publishes a value

##### publishValue Parameters

| Name | Type | Description |
| ---------- | ------------ | ----------------- |
| `nodeId` | `string` | id of the zwave device | |
| `zwaveValue` | `object` | new value information structure of the device class | |
| `reasonString` | `string` | the reason string | |

#### publishValueChange

`publishValueChange (nodeId, comClass, value)`

Publishes a value change

##### publishValueChange Parameters

| Name | Type | Description |
| ---------- | ------------ | ----------------- |
| `nodeId` | `string` | id of the zwave device | |
| `comClass` | `string` | parameter class | |
| `value` | `object` | new value information structure of the device class | |

#### registerZwaveCallbacks

`registerZwaveCallbacks ()`

Register callbacks for zwave

#### removeFailedNode

`removeFailedNode ()`

Remove/delete a failed node or device

#### requestConfigParametersForAllNodes

`requestConfigParametersForAllNodes ()`

Iterates through all configurated nodes and requests their configuration parameters

#### setDeviceConfiguration

`setDeviceConfiguration (devices)`

Sets the zwave device configuration

##### setDeviceConfiguration Parameters

| Name | Type | Description |
| ---------- | ------------ | ----------------- |
| `devices` | `Devices` | tree of device configuration information | |

#### setNodeInfo

`setNodeInfo (nodeId, nodeInfo)`

Sets the node info

##### setNodeInfo Parameters

| Name | Type | Description |
| ---------- | ------------ | ----------------- |
| `nodeId` | `string` | id of the zwave device node | |
| `nodeInfo` | `object` | additional information for the node | |

#### setValue

`setValue (topic, value)`

Sets a value

##### setValue Parameters

| Name | Type | Description |
| ---------- | ------------ | ----------------- |
| `topic` | `string` | name of the topic | |
| `value` | `string, number, boolean` | to set | |

## Class ZwaveDevices

`new ZwaveDevices(config)`

Constructs a new zwave controller and binds it to an input device

### ZwaveDevices Parameters

| Name | Type | Description |
| ---------- | ------------ | ----------------- |
| `config` | `object` | zwave controller configuration | |

#### config properties

| Name | Type | Description |
| ---------- | ------------ | ----------------- |
| `devices` | `object, array` | device definition structure | |

### ZwaveDevices Methods

#### topicToZwaveId

`topicToZwaveId (nodes, topic, label) => {DeviceConfig}`

Gets a full set of zwave identifiers based on the zwave device configuration , default values for instance , index and type - if they are undefined in the configuration and the class_id based on the label - if it is undefined in the configuration

##### topicToZwaveId Parameters

| Name | Type | Description |
| ---------- | ------------ | ----------------- |
| `nodes` | `Array.<object>` | zwave nodes structure | |
| `topic` | `topic` | topic to look for | |
| `label` | `string` | label of the setting | |

##### topicToZwaveId returns

| Type | Description |
| ---- | ----------- |
| `DeviceConfig` | zwaveId ( node_id , class_id , instance , index , type ) |

## Class ZwaveService

`new ZwaveService(options)`

Creates a remote service

### ZwaveService Parameters

| Name | Type | Description |
| ---------- | ------------ | ----------------- |
| `options` | `Object` | configuration settings for zwave | |

#### options properties

| Name | Type | Description |
| ---------- | ------------ | ----------------- |
| `usb` | `string` | zwave usb device name | |
| `services` | `Array.<Service>` | list of supported services | |

### ZwaveService Methods

#### _setValueIdToDevices

`_setValueIdToDevices ()`

Iterates through the zwave devices adding value ids

#### close

`async close ()`

Closes the broker , stops listening

#### getSubscriptions

`getSubscriptions () => {topic:qos}`

Gets the list of required subscriptions for this service

##### getSubscriptions returns

| Type | Description |
| ---- | ----------- |
| `topic:qos` | list of subscription strings |

#### handleMessage

`handleMessage (message)`

Processes an incoming mqtt message

##### handleMessage Parameters

| Name | Type | Description |
| ---------- | ------------ | ----------------- |
| `message` | `Message` | mqtt message | |

#### on

`on (event, callback)`

Sets a callback .

##### on Parameters

| Name | Type | Description |
| ---------- | ------------ | ----------------- |
| `event` | `string` | event name ( not case sensitive ) for the callback | |
| `callback` | `function` | function ( . . . parameter ) | |

##### on throws

| Type | Description |
| ---- | ----------- |
| `Error` | if the event is not supported |
| `Error` | if the callback is not 'function' |

#### run

`run ()`

Called once after registration to handle additional tasks

#### setDeviceConfiguration

`setDeviceConfiguration (config)`


##### setDeviceConfiguration Parameters

| Name | Type | Description |
| ---------- | ------------ | ----------------- |
| `config` | `Object` | configuration settings for zwave | |
